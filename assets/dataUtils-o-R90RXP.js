import{aD as _t,a7 as Dt,kx as pt,aO as Rt,a9 as Z,aL as W,aM as J,aP as Lt,aN as Et,cT as jt,bx as nt,ac as Nt,ky as vt,c9 as Gt,c4 as qt,av as Ot}from"./index-BuurUjNy.js";let Ut=class{constructor(e=null,n=null,o=null){this.minValue=e,this.maxValue=n,this.noDataValue=o}};var K;let G=K=class extends _t{static createEmptyBand(t,e){return new(K.getPixelArrayConstructor(t))(e)}static combineBandMasks(t){if(t.length<2)return t[0];const e=t[0].length,n=new Uint8Array(e).fill(255);for(let o=0;o<t.length;o++){const a=t[o];for(let i=0;i<e;i++)a[i]||(n[i]=0)}return n}static getPixelArrayConstructor(t){let e;switch(t){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":e=Float32Array;break;case"f64":e=Float64Array}return e}constructor(t){super(t),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(t){if(!t)return"f32";let e=t.toLowerCase();return["u1","u2","u4"].includes(e)?e="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(e)||(e="f32"),e}getPlaneCount(){var t;return(t=this.pixels)==null?void 0:t.length}addData(t){if(!t.pixels||t.pixels.length!==this.width*this.height)throw new Dt("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(t.pixels),this.statistics.push(t.statistics??new Ut)}getAsRGBA(){const t=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(t);break;default:this._fillFrom8Bit(t)}return new Uint8ClampedArray(t)}getAsRGBAFloat(){const t=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(t),t}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map(n=>Wt(n,this.mask));const t=this.mask;let e=0;if(t!=null)for(let n=0;n<t.length;n++)t[n]&&e++;else e=this.width*this.height;this.validPixelCount=e}clamp(t){if(!t||t==="f64"||t==="f32"||!this.pixels)return;const[e,n]=pt(t),o=this.pixels,a=this.width*this.height,i=o.length;let r,u,h;const s=[];for(let l=0;l<i;l++){h=K.createEmptyBand(t,a),r=o[l];for(let c=0;c<a;c++)u=r[c],h[c]=u>n?n:u<e?e:u;s.push(h)}this.pixels=s,this.pixelType=t}extractBands(t){var c;const{pixels:e,statistics:n}=this;if(t==null||t.length===0||!e||e.length===0)return this;const o=e.length,a=t.some(p=>p>=e.length),i=o===t.length&&!t.some((p,f)=>p!==f);if(a||i)return this;const r=((c=this.bandMasks)==null?void 0:c.length)===o?t.map(p=>this.bandMasks[p]):void 0;let{mask:u,validPixelCount:h}=this;const{width:s,height:l}=this;return r!=null&&r.length&&(u=K.combineBandMasks(r),h=u.filter(p=>!!p).length),new K({pixelType:this.pixelType,width:s,height:l,mask:u,bandMasks:r,validPixelCount:h,maskIsAlpha:this.maskIsAlpha,pixels:t.map(p=>e[p]),statistics:n&&t.map(p=>n[p])})}clone(){const t=new K({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});let e;this.mask!=null&&(t.mask=new Uint8Array(this.mask)),this.bandMasks&&(t.bandMasks=this.bandMasks.map(o=>new Uint8Array(o)));const n=K.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){t.pixels=[];const o=!!this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)t.pixels[e]=o?this.pixels[e].slice():new n(this.pixels[e])}if(this.statistics)for(t.statistics=[],e=0;e<this.statistics.length;e++)t.statistics[e]=Rt(this.statistics[e]);return t.premultiplyAlpha=this.premultiplyAlpha,t}_fillFrom8Bit(t){const{mask:e,maskIsAlpha:n,premultiplyAlpha:o,pixels:a}=this;if(!t||!(a!=null&&a.length))return void Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let i,r,u,h;i=r=u=a[0],a.length>=3?(r=a[1],u=a[2]):a.length===2&&(r=a[1]);const s=new Uint32Array(t),l=this.width*this.height;if(i.length===l)if(e!=null&&e.length===l)if(n)for(h=0;h<l;h++){const c=e[h];if(c){const p=c/255;s[h]=o?c<<24|u[h]*p<<16|r[h]*p<<8|i[h]*p:c<<24|u[h]<<16|r[h]<<8|i[h]}}else for(h=0;h<l;h++)e[h]&&(s[h]=255<<24|u[h]<<16|r[h]<<8|i[h]);else for(h=0;h<l;h++)s[h]=255<<24|u[h]<<16|r[h]<<8|i[h];else Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(t){const{pixels:e,mask:n,statistics:o}=this;if(!t||!(e!=null&&e.length))return void Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");const a=this.pixelType;let i=1,r=0,u=1;if(o&&o.length>0){for(const m of o)if(m.minValue!=null&&(r=Math.min(r,m.minValue)),m.maxValue!=null&&m.minValue!=null){const x=m.maxValue-m.minValue;u=Math.max(u,x)}i=255/u}else{let m=255;a==="s8"?(r=-128,m=127):a==="u16"?m=65535:a==="s16"?(r=-32768,m=32767):a==="u32"?m=4294967295:a==="s32"?(r=-2147483648,m=2147483647):a==="f32"?(r=-34e38,m=34e38):a==="f64"&&(r=-Number.MAX_VALUE,m=Number.MAX_VALUE),i=255/(m-r)}const h=new Uint32Array(t),s=this.width*this.height;let l,c,p,f,d;if(l=c=p=e[0],l.length!==s)return Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(e.length>=2)if(c=e[1],e.length>=3&&(p=e[2]),n!=null&&n.length===s)for(f=0;f<s;f++)n[f]&&(h[f]=255<<24|(p[f]-r)*i<<16|(c[f]-r)*i<<8|(l[f]-r)*i);else for(f=0;f<s;f++)h[f]=255<<24|(p[f]-r)*i<<16|(c[f]-r)*i<<8|(l[f]-r)*i;else if(n!=null&&n.length===s)for(f=0;f<s;f++)d=(l[f]-r)*i,n[f]&&(h[f]=255<<24|d<<16|d<<8|d);else for(f=0;f<s;f++)d=(l[f]-r)*i,h[f]=255<<24|d<<16|d<<8|d}_fillFrom32Bit(t){const{pixels:e,mask:n}=this;if(!t||!(e!=null&&e.length))return Z.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let o,a,i,r;o=a=i=e[0],e.length>=3?(a=e[1],i=e[2]):e.length===2&&(a=e[1]);const u=this.width*this.height;if(o.length!==u)return Z.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let h=0;if(n!=null&&n.length===u)for(r=0;r<u;r++)t[h++]=o[r],t[h++]=a[r],t[h++]=i[r],t[h++]=1&n[r];else for(r=0;r<u;r++)t[h++]=o[r],t[h++]=a[r],t[h++]=i[r],t[h++]=1}};function Wt(t,e){let n=1/0,o=-1/0;const a=t.length;let i,r=0;if(e!=null)for(i=0;i<a;i++)e[i]&&(r=t[i],n=r<n?r:n,o=r>o?r:o);else for(i=0;i<a;i++)r=t[i],n=r<n?r:n,o=r>o?r:o;return new Ut(n,o)}W([J({json:{write:!0}})],G.prototype,"width",void 0),W([J({json:{write:!0}})],G.prototype,"height",void 0),W([J({json:{write:!0}})],G.prototype,"pixelType",void 0),W([Lt("pixelType")],G.prototype,"castPixelType",null),W([J({json:{write:!0}})],G.prototype,"validPixelCount",void 0),W([J({json:{write:!0}})],G.prototype,"mask",void 0),W([J({json:{write:!0}})],G.prototype,"maskIsAlpha",void 0),W([J({json:{write:!0}})],G.prototype,"pixels",void 0),W([J()],G.prototype,"premultiplyAlpha",void 0),W([J({json:{write:!0}})],G.prototype,"statistics",void 0),W([J({json:{write:!0}})],G.prototype,"depthCount",void 0),W([J({json:{write:!0}})],G.prototype,"noDataValues",void 0),W([J({json:{write:!0}})],G.prototype,"bandMasks",void 0),G=K=W([Et("esri.layers.support.PixelBlock")],G);const _=G;var gt,xt;(function(t){t[t.matchAny=0]="matchAny",t[t.matchAll=1]="matchAll"})(gt||(gt={})),function(t){t[t.bestMatch=0]="bestMatch",t[t.fail=1]="fail"}(xt||(xt={}));const me=6;function R(t){return t!=null&&t.declaredClass==="esri.layers.support.PixelBlock"&&t.pixels&&t.pixels.length>0}function ge(t){var l;if(!(t!=null&&t.length)||t.some(c=>!R(c)))return null;if(t.length===1)return((l=t[0])==null?void 0:l.clone())??null;const e=t,{width:n,height:o,pixelType:a}=e[0];if(e.some(c=>c.width!==n||c.height!==o))return null;const i=e.map(({mask:c})=>c).filter(c=>c!=null);let r=null;i.length&&(r=new Uint8Array(n*o),r.set(i[0]),i.length>1&&Tt(i.slice(1),r));const u=[];e.forEach(({pixels:c})=>u.push(...c));const h=e.map(({statistics:c})=>c).filter(c=>c==null?void 0:c.length),s=[];return h.forEach(c=>s.push(...c)),new _({pixelType:a,width:n,height:o,mask:r,pixels:u,statistics:s.length?s:null})}function xe(t){if(!t)return;const e=t.colormap;if(!e||e.length===0)return;const n=e.sort((c,p)=>c[0]-p[0]);let o=0;n[0][0]<0&&(o=n[0][0]);const a=Math.max(256,n[n.length-1][0]-o+1),i=new Uint8Array(4*a),r=[];let u,h=0,s=0;const l=n[0].length===5;if(a>65536)return n.forEach(c=>{r[c[0]-o]=l?c.slice(1):c.slice(1).concat([255])}),{indexed2DColormap:r,offset:o,alphaSpecified:l};if(t.fillUnspecified)for(u=n[s],h=u[0]-o;h<a;h++)i[4*h]=u[1],i[4*h+1]=u[2],i[4*h+2]=u[3],i[4*h+3]=l?u[4]:255,h===u[0]-o&&(u=s===n.length-1?u:n[++s]);else for(h=0;h<n.length;h++)u=n[h],s=4*(u[0]-o),i[s]=u[1],i[s+1]=u[2],i[s+2]=u[3],i[s+3]=l?u[4]:255;return{indexedColormap:i,offset:o,alphaSpecified:l}}function we(t,e){if(!R(t)||!e||!e.indexedColormap&&!e.indexed2DColormap)return t;const n=t.clone(),o=n.pixels;let a=n.mask;const i=n.width*n.height;if(o.length!==1)return t;const{indexedColormap:r,indexed2DColormap:u,offset:h,alphaSpecified:s}=e;let l=0;const c=o[0],p=new Uint8Array(c.length),f=new Uint8Array(c.length),d=new Uint8Array(c.length);let m,x=0;if(r){const w=r.length-1;if(a!=null)for(l=0;l<i;l++)a[l]&&(x=4*(c[l]-h),x<h||x>w?a[l]=0:(p[l]=r[x],f[l]=r[x+1],d[l]=r[x+2],a[l]=r[x+3]));else{for(a=new Uint8Array(i),l=0;l<i;l++)x=4*(c[l]-h),x<h||x>w?a[l]=0:(p[l]=r[x],f[l]=r[x+1],d[l]=r[x+2],a[l]=r[x+3]);n.mask=a}}else if(u)if(a!=null)for(l=0;l<i;l++)a[l]&&(m=u[c[l]],p[l]=m[0],f[l]=m[1],d[l]=m[2],a[l]=m[3]);else{for(a=new Uint8Array(i),l=0;l<i;l++)m=u[c[l]],p[l]=m[0],f[l]=m[1],d[l]=m[2],a[l]=m[3];n.mask=a}return n.pixels=[p,f,d],n.statistics=null,n.pixelType="u8",n.maskIsAlpha=s,n}function ye(t,e){if(!R(t))return null;const{pixels:n,mask:o}=t,a=n.length;let i=e.lut;const{offset:r}=e;i&&i[0].length===1&&(i=n.map(()=>i));const u=[],h=e.outputPixelType||"u8";for(let l=0;l<a;l++){const c=Pt(n[l],o,i[l],r||0,h);u.push(c)}const s=new _({width:t.width,height:t.height,pixels:u,mask:o,pixelType:h});return s.updateStatistics(),s}function Pt(t,e,n,o,a){const i=t.length,r=_.createEmptyBand(a,i);if(e)for(let u=0;u<i;u++)e[u]&&(r[u]=n[t[u]-o]);else for(let u=0;u<i;u++)r[u]=n[t[u]-o];return r}function ke(t,e){if(!R(t))return null;const n=t.clone(),{pixels:o}=n,a=n.width*n.height,i=e.length,r=Math.floor(i/2),u=e[Math.floor(r)],h=o[0];let s,l,c,p,f,d,m=!1;const x=new Uint8Array(a),w=new Uint8Array(a),A=new Uint8Array(a);let k=n.mask;const M=e[0].mappedColor.length===4;for(k||(k=new Uint8Array(a),k.fill(M?255:1),n.mask=k),f=0;f<a;f++)if(k[f]){for(s=h[f],m=!1,d=r,l=u,c=0,p=i-1;p-c>1;){if(s===l.value){m=!0;break}s>l.value?c=d:p=d,d=Math.floor((c+p)/2),l=e[Math.floor(d)]}m||(s===e[c].value?(l=e[c],m=!0):s===e[p].value?(l=e[p],m=!0):s<e[c].value?(m=!1,l=null):s>e[c].value&&(s<e[p].value?(l=e[c],m=!0):p===i-1?(m=!1,l=null):(l=e[p],m=!0))),m?(x[f]=l.mappedColor[0],w[f]=l.mappedColor[1],A[f]=l.mappedColor[2],k[f]=l.mappedColor[3]):x[f]=w[f]=A[f]=k[f]=0}return n.pixels=[x,w,A],n.mask=k,n.pixelType="u8",n.maskIsAlpha=M,n}function Me(t,e){if(!R(t))return null;const{width:n,height:o}=t,{inputRanges:a,outputValues:i,outputPixelType:r,noDataRanges:u,allowUnmatched:h,isLastInputRangeInclusive:s}=e,l=t.pixels[0],c=_.createEmptyBand(r,l.length),p=t.mask,f=new Uint8Array(n*o);p?f.set(p):f.fill(255);const d=t.pixelType.startsWith("f")?1e-6:0,m=a.map(M=>M-d);m[0]=a[0],m[m.length-1]=a[a.length-1]+(s?1e-6:0);const x=a.length/2,[w,A]=pt(r);for(let M=0;M<o;M++)for(let g=0;g<n;g++){const y=M*n+g;if(f[y]){const U=l[y];let b=!1;for(let T=x-1;T>=0;T--)if(U===m[2*T]||U>m[2*T]&&U<m[2*T+1]){c[y]=i[T],b=!0;break}b||(h?c[y]=U>A?A:U<w?w:U:f[y]=0)}}const k=u==null?void 0:u.length;if(k)for(let M=0;M<o;M++)for(let g=0;g<n;g++){const y=M*n+g;if(!p||p[y]){const U=l[y];for(let b=0;b<k;b+=2)if(U>=u[b]&&U<=u[b+1]){c[y]=0,f[y]=0;break}}}return new _({width:n,height:o,pixelType:r,pixels:[c],mask:f})}function wt(t,e,n,o){const a=n!=null&&n.length>=2?new Set(n):null,i=(n==null?void 0:n.length)===1?n[0]:null,r=!!(e!=null&&e.length);for(let u=0;u<t.length;u++)if(o[u]){const h=t[u];if(r){let s=!1;for(let l=0;l<e.length;l+=2)if(h>=e[l]&&h<=e[l+1]){s=!0;break}s||(o[u]=0)}o[u]&&(h===i||a!=null&&a.has(h))&&(o[u]=0)}}function yt(t,e){const n=t[0].length;for(let o=0;o<n;o++)if(e[o]){let a=!1;for(let i=0;i<t.length;i++)if(t[i][o]){a=!0;break}a||(e[o]=0)}}function Tt(t,e){const n=t[0].length;for(let o=0;o<n;o++)if(e[o]){let a=!1;for(let i=0;i<t.length;i++)if(t[i][o]===0){a=!0;break}a&&(e[o]=0)}}function Ae(t,e){if(!R(t))return null;const{width:n,height:o,pixels:a}=t,i=n*o,r=new Uint8Array(i);t.mask?r.set(t.mask):r.fill(255);const u=a.length,{includedRanges:h,noDataValues:s,outputPixelType:l,matchAll:c,lookups:p}=e;if(p){const f=[];for(let d=0;d<u;d++){const m=p[d],x=Pt(a[d],r,m.lut,m.offset||0,"u8");f.push(x)}f.length===1?r.set(f[0]):c?yt(f,r):Tt(f,r)}else if(c){const f=[];for(let d=0;d<u;d++){const m=new Uint8Array(i);m.set(r),wt(a[d],h==null?void 0:h.slice(2*d,2*d+2),s==null?void 0:s[d],m),f.push(m)}f.length===1?r.set(f[0]):yt(f,r)}else for(let f=0;f<u;f++)wt(a[f],h==null?void 0:h.slice(2*f,2*f+2),s==null?void 0:s[f],r);return new _({width:n,height:o,pixelType:l,pixels:a,mask:r})}function be(t){const{srcPixelType:e,inputRanges:n,outputValues:o,allowUnmatched:a,noDataRanges:i,isLastInputRangeInclusive:r,outputPixelType:u}=t;if(e!=="u8"&&e!=="s8"&&e!=="u16"&&e!=="s16")return null;const h=e.includes("16")?65536:256,s=e.includes("s")?-h/2:0,l=_.createEmptyBand(u,h),c=new Uint8Array(h);a&&c.fill(255);const[p,f]=pt(u);if(n!=null&&n.length&&(o!=null&&o.length)){const m=n.map(x=>x-1e-6);m[0]=n[0],r&&(m[m.length-1]=n[n.length-1]);for(let x=0;x<m.length;x++){const w=o[x]>f?f:o[x]<p?p:o[x],A=Math.ceil(m[2*x]-s),k=Math.floor(m[2*x+1]-s);for(let M=A;M<=k;M++)l[M]=w,c[M]=255}}if(i!=null&&i.length)for(let d=0;d<i.length;d++){const m=Math.ceil(i[2*d]-s),x=Math.floor(i[2*d+1]-s);for(let w=m;w<=x;w++)c[w]=0}return{lut:l,offset:s,mask:c}}function ve(t,e,n){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;const o=t.includes("16")?65536:256,a=t.includes("s")?-o/2:0,i=new Uint8Array(o);if(e)for(let r=0;r<e.length;r++){const u=Math.ceil(e[2*r]-a),h=Math.floor(e[2*r+1]-a);for(let s=u;s<=h;s++)i[s]=255}else i.fill(255);if(n)for(let r=0;r<n.length;r++)i[n[r]-a]=0;return{lut:i,offset:a}}function zt(t,e,n,o,a,i,r,u){return{xmin:a<=n*t?0:a<n*t+t?a-n*t:t,ymin:i<=o*e?0:i<o*e+e?i-o*e:e,xmax:a+r<=n*t?0:a+r<n*t+t?a+r-n*t:t,ymax:i+u<=o*e?0:i+u<o*e+e?i+u-o*e:e}}function Ue(t,e){if(!t||t.length===0)return null;const n=t.find(d=>d.pixelBlock);if((n==null?void 0:n.pixelBlock)==null)return null;const o=(n.extent.xmax-n.extent.xmin)/n.pixelBlock.width,a=(n.extent.ymax-n.extent.ymin)/n.pixelBlock.height,i=.01*Math.min(o,a),r=t.sort((d,m)=>Math.abs(d.extent.ymax-m.extent.ymax)>i?m.extent.ymax-d.extent.ymax:Math.abs(d.extent.xmin-m.extent.xmin)>i?d.extent.xmin-m.extent.xmin:0),u=Math.min.apply(null,r.map(d=>d.extent.xmin)),h=Math.min.apply(null,r.map(d=>d.extent.ymin)),s=Math.max.apply(null,r.map(d=>d.extent.xmax)),l=Math.max.apply(null,r.map(d=>d.extent.ymax)),c={x:Math.round((e.xmin-u)/o),y:Math.round((l-e.ymax)/a)},p={width:Math.round((s-u)/o),height:Math.round((l-h)/a)},f={width:Math.round((e.xmax-e.xmin)/o),height:Math.round((e.ymax-e.ymin)/a)};return Math.round(p.width/n.pixelBlock.width)*Math.round(p.height/n.pixelBlock.height)!==r.length||c.x<0||c.y<0||p.width<f.width||p.height<f.height?null:{extent:e,pixelBlock:Jt(r.map(d=>d.pixelBlock),p,{clipOffset:c,clipSize:f})}}function ct(t,e,n,o,a,i){const{width:r,height:u}=n.block,{x:h,y:s}=n.offset,{width:l,height:c}=n.mosaic,p=zt(r,u,o,a,h,s,l,c);let f=0,d=0;if(i){const m=i.hasGCSSShiftTransform?360:i.halfWorldWidth??0,x=r*i.resolutionX,w=i.startX+o*x;w<m&&w+x>m?d=i.rightPadding:w>=m&&(f=i.leftMargin-i.rightPadding,d=0)}if(p.xmax-=d,typeof e!="number")for(let m=p.ymin;m<p.ymax;m++){const x=(a*u+m-s)*l+(o*r-h)+f,w=m*r;for(let A=p.xmin;A<p.xmax;A++)t[x+A]=e[w+A]}else for(let m=p.ymin;m<p.ymax;m++){const x=(a*u+m-s)*l+(o*r-h)+f;for(let w=p.xmin;w<p.xmax;w++)t[x+w]=e}}function Jt(t,e,n={}){var I;const{clipOffset:o,clipSize:a,alignmentInfo:i,blockWidths:r}=n;if(r)return Xt(t,e,{blockWidths:r});const u=t.find(P=>R(P));if(u==null)return null;const h=a?a.width:e.width,s=a?a.height:e.height,l=u.width,c=u.height,p=e.width/l,f=e.height/c,d={offset:o||{x:0,y:0},mosaic:a||e,block:{width:l,height:c}},m=u.pixelType,x=_.getPixelArrayConstructor(m),w=u.pixels.length,A=[];let k,M;for(let P=0;P<w;P++){M=new x(h*s);for(let v=0;v<f;v++)for(let B=0;B<p;B++){const F=t[v*p+B];R(F)&&(k=F.pixels[P],ct(M,k,d,B,v,i))}A.push(M)}const g=t.some(P=>P==null||P.mask!=null&&P.mask.length>0),y=t.some(P=>(P==null?void 0:P.bandMasks)&&P.bandMasks.length>1),U=g?new Uint8Array(h*s):void 0,b=y?[]:void 0;if(U){for(let P=0;P<f;P++)for(let v=0;v<p;v++){const B=t[P*p+v],F=B!=null?B.mask:null;ct(U,F??(B?255:0),d,v,P,i)}if(b)for(let P=0;P<w;P++){const v=new Uint8Array(h*s);for(let B=0;B<f;B++)for(let F=0;F<p;F++){const S=t[B*p+F],$=((I=S==null?void 0:S.bandMasks)==null?void 0:I[P])??(S==null?void 0:S.mask);ct(v,$??(S?255:0),d,F,B,i)}b.push(v)}}const T=new _({width:h,height:s,pixels:A,pixelType:m,bandMasks:b,mask:U});return T.updateStatistics(),T}function Xt(t,e,n){var x;const o=t.find(w=>w!=null);if(o==null)return null;const a=t.some(w=>w==null||!!w.mask),{width:i,height:r}=e,u=a?new Uint8Array(i*r):null,{blockWidths:h}=n,s=[],l=o.getPlaneCount(),c=_.getPixelArrayConstructor(o.pixelType);if(a)for(let w=0,A=0;w<t.length;A+=h[w],w++){const k=t[w];if(!R(k))continue;const M=k.mask;for(let g=0;g<r;g++)for(let y=0;y<h[w];y++)u[g*i+y+A]=M==null?255:M[g*k.width+y]}const p=t.some(w=>(w==null?void 0:w.bandMasks)&&w.bandMasks.length>1),f=p?[]:void 0,d=i*r;for(let w=0;w<l;w++){const A=new c(d),k=p?new Uint8Array(d):void 0;for(let M=0,g=0;M<t.length;g+=h[M],M++){const y=t[M];if(!R(y))continue;const U=y.pixels[w];if(U!=null){for(let b=0;b<r;b++)for(let T=0;T<h[M];T++)A[b*i+T+g]=U[b*y.width+T];if(k){const b=((x=y.bandMasks)==null?void 0:x[w])??y.mask;for(let T=0;T<r;T++)for(let I=0;I<h[M];I++)k[T*i+I+g]=b?b[T*y.width+I]:255}}}s.push(A),f&&k&&f.push(k)}const m=new _({width:i,height:r,mask:u,bandMasks:f,pixels:s,pixelType:o.pixelType});return m.updateStatistics(),m}function Pe(t,e,n){if(!R(t))return null;const{width:o,height:a}=t,i=e.x,r=e.y,u=n.width+i,h=n.height+r;if(i<0||r<0||u>o||h>a||i===0&&r===0&&u===o&&h===a)return t;t.mask||(t.mask=new Uint8Array(o*a));const s=t.mask;for(let l=0;l<a;l++){const c=l*o;for(let p=0;p<o;p++)s[c+p]=l<r||l>=h||p<i||p>=u?0:1}return t.updateStatistics(),t}function Ht(t){if(!R(t))return null;const e=t.clone(),{width:n,height:o,pixels:a}=t,i=a[0],r=e.pixels[0],u=t.mask;for(let h=2;h<o-1;h++){const s=new Map;for(let c=h-2;c<h+2;c++)for(let p=0;p<4;p++){const f=c*n+p;st(s,i[f],u?u[f]:1)}r[h*n]=kt(s),r[h*n+1]=r[h*n+2]=r[h*n];let l=3;for(;l<n-1;l++){let c=(h-2)*n+l+1;st(s,i[c],u?u[c]:1),c=(h-1)*n+l+1,st(s,i[c],u?u[c]:1),c=h*n+l+1,st(s,i[c],u?u[c]:1),c=(h+1)*n+l+1,st(s,i[c],u?u[c]:1),c=(h-2)*n+l-3,rt(s,i[c],u?u[c]:1),c=(h-1)*n+l-3,rt(s,i[c],u?u[c]:1),c=h*n+l-3,rt(s,i[c],u?u[c]:1),c=(h+1)*n+l-3,rt(s,i[c],u?u[c]:1),r[h*n+l]=kt(s)}r[h*n+l+1]=r[h*n+l]}for(let h=0;h<n;h++)r[h]=r[n+h]=r[2*n+h],r[(o-1)*n+h]=r[(o-2)*n+h];return e.updateStatistics(),e}function kt(t){if(t.size===0)return 0;let e=0,n=-1,o=0;const a=t.keys();let i=a.next();for(;!i.done;)o=t.get(i.value),o>e&&(n=i.value,e=o),i=a.next();return n}function rt(t,e,n){if(n===0)return;const o=t.get(e);o===1?t.delete(e):t.set(e,o-1)}function st(t,e,n){n!==0&&t.set(e,t.has(e)?t.get(e)+1:1)}function It(t,e,n){let{x:o,y:a}=e;const{width:i,height:r}=n;if(o===0&&a===0&&r===t.height&&i===t.width)return t;const{width:u,height:h}=t,s=Math.max(0,a),l=Math.max(0,o),c=Math.min(o+i,u),p=Math.min(a+r,h);if(c<0||p<0||!R(t))return null;o=Math.max(0,-o),a=Math.max(0,-a);const{pixels:f}=t,d=i*r,m=f.length,x=[];for(let M=0;M<m;M++){const g=f[M],y=_.createEmptyBand(t.pixelType,d);for(let U=s;U<p;U++){const b=U*u;let T=(U+a-s)*i+o;for(let I=l;I<c;I++)y[T++]=g[b+I]}x.push(y)}const w=new Uint8Array(d),A=t.mask;for(let M=s;M<p;M++){const g=M*u;let y=(M+a-s)*i+o;for(let U=l;U<c;U++)w[y++]=A?A[g+U]:1}const k=new _({width:n.width,height:n.height,pixelType:t.pixelType,pixels:x,mask:w});return k.updateStatistics(),k}function $t(t,e=!0){if(!R(t))return null;const{pixels:n,width:o,height:a,mask:i,pixelType:r}=t,u=[],h=Math.round(o/2),s=Math.round(a/2),l=a-1,c=o-1;for(let f=0;f<n.length;f++){const d=n[f],m=_.createEmptyBand(r,h*s);let x=0;for(let w=0;w<a;w+=2)for(let A=0;A<o;A+=2){const k=d[w*o+A];if(e){const M=A===c?k:d[w*o+A+1],g=w===l?k:d[w*o+A+o],y=A===c?g:w===l?M:d[w*o+A+o+1];m[x++]=(k+M+g+y)/4}else m[x++]=k}u.push(m)}let p=null;if(i!=null){p=new Uint8Array(h*s);let f=0;for(let d=0;d<a;d+=2)for(let m=0;m<o;m+=2){const x=i[d*o+m];if(e){const w=m===c?x:i[d*o+m+1],A=d===l?x:i[d*o+m+o],k=m===c?A:d===l?w:i[d*o+m+o+1];p[f++]=x*w*A*k?1:0}else p[f++]=x}}return new _({width:h,height:s,pixelType:r,pixels:u,mask:p})}function Te(t,e,n=0,o=!0){if(!R(t))return null;const{width:a,height:i}=e;let{width:r,height:u}=t;const h=new Map,s={x:0,y:0},l=1+n;let c=t;for(let p=0;p<l;p++){const f=Math.ceil(r/a),d=Math.ceil(u/i);for(let m=0;m<d;m++){s.y=m*i;for(let x=0;x<f;x++){s.x=x*a;const w=It(c,s,e);h.set(`${p}/${m}/${x}`,w)}}p<l-1&&(c=$t(c,o)),r=Math.round(r/2),u=Math.round(u/2)}return h}function Ie(t){const{pixelBlock:e,tileSize:n,level:o,row:a,col:i,useBilinear:r}=t;if(!R(e))return null;const{width:u,height:h}=n,s=2**o,l=s*u,c=s*h;let p=It(e,{y:a*c,x:i*l},{width:l,height:c});if(!p)return null;for(let f=o;f>0;f--)p=$t(p,r);return p}function Bt(t,e,n,o,a=0){const{width:i,height:r}=t,{width:u,height:h}=e,s=o.cols,l=o.rows,c=Math.ceil(u/s-.1/s),p=Math.ceil(h/l-.1/l);let f,d,m,x,w,A,k;const M=c*s,g=M*p*l,y=new Float32Array(g),U=new Float32Array(g),b=new Uint32Array(g),T=new Uint32Array(g);let I,P,v=0;for(let B=0;B<p;B++)for(let F=0;F<c;F++){f=12*(B*c+F),d=n[f],m=n[f+1],x=n[f+2],w=n[f+3],A=n[f+4],k=n[f+5];for(let S=0;S<l;S++){v=(B*l+S)*M+F*s,P=(S+.5)/l;for(let $=0;$<S;$++)I=($+.5)/s,y[v+$]=(d*I+m*P+x)*i+a,U[v+$]=(w*I+A*P+k)*r+a,b[v+$]=Math.floor(y[v+$]),T[v+$]=Math.floor(U[v+$])}f+=6,d=n[f],m=n[f+1],x=n[f+2],w=n[f+3],A=n[f+4],k=n[f+5];for(let S=0;S<l;S++){v=(B*l+S)*M+F*s,P=(S+.5)/l;for(let $=S;$<s;$++)I=($+.5)/s,y[v+$]=(d*I+m*P+x)*i+a,U[v+$]=(w*I+A*P+k)*r+a,b[v+$]=Math.floor(y[v+$]),T[v+$]=Math.floor(U[v+$])}}return{offsets_x:y,offsets_y:U,offsets_xi:b,offsets_yi:T,gridWidth:M}}function $e(t,e){const{coefficients:n,spacing:o}=e,{offsets_x:a,offsets_y:i,gridWidth:r}=Bt(t,t,n,{rows:o[0],cols:o[1]}),{width:u,height:h}=t,s=new Float32Array(u*h),l=180/Math.PI;for(let c=0;c<h;c++)for(let p=0;p<u;p++){const f=c*r+p,d=c===0?f:f-r,m=c===h-1?f:f+r,x=a[d]-a[m],w=i[m]-i[d];if(isNaN(x)||isNaN(w))s[c*u+p]=90;else{let A=Math.atan2(w,x)*l;A=(360+A)%360,s[c*u+p]=A}}return s}function Be(t,e,n,o,a="nearest"){if(!R(t))return null;a==="majority"&&(t=Ht(t));const{pixels:i,mask:r,bandMasks:u,pixelType:h}=t,s=t.width,l=t.height,c=_.getPixelArrayConstructor(h),p=i.length,{width:f,height:d}=e;let m=!1;for(let v=0;v<n.length;v+=3)n[v]===-1&&n[v+1]===-1&&n[v+2]===-1&&(m=!0);const{offsets_x:x,offsets_y:w,offsets_xi:A,offsets_yi:k,gridWidth:M}=Bt({width:s,height:l},e,n,o,a==="majority"?.5:0);let g;const y=(v,B,F,S)=>{const $=v instanceof Float32Array||v instanceof Float64Array?0:.5;for(let C=0;C<d;C++){g=C*M;for(let V=0;V<f;V++){if(x[g]<0||w[g]<0)v[C*f+V]=0;else if(S)v[C*f+V]=B[A[g]+k[g]*s];else{const j=Math.floor(x[g]),O=Math.floor(w[g]),L=Math.ceil(x[g]),q=Math.ceil(w[g]),z=x[g]-j,H=w[g]-O;if(!F||F[j+O*s]&&F[L+O*s]&&F[j+q*s]&&F[L+q*s]){const et=(1-z)*B[j+O*s]+z*B[L+O*s],Q=(1-z)*B[j+q*s]+z*B[L+q*s];v[C*f+V]=(1-H)*et+H*Q+$}else v[C*f+V]=B[A[g]+k[g]*s]}g++}}},U=[];let b;const T=(u==null?void 0:u.length)===p,I=[];for(let v=0;v<p;v++){if(T){const B=new Uint8Array(f*d);y(B,u[v],u[v],!0),I.push(B)}b=new c(f*d),y(b,i[v],T?u[v]:r,a==="nearest"||a==="majority"),U.push(b)}const P=new _({width:f,height:d,pixelType:h,pixels:U,bandMasks:T?I:void 0});if(r!=null)P.mask=new Uint8Array(f*d),y(P.mask,r,r,!0);else if(m){P.mask=new Uint8Array(f*d);for(let v=0;v<f*d;v++)P.mask[v]=x[v]<0||w[v]<0?0:1}return P.updateStatistics(),P}const tt=new Map;tt.set("meter-per-second",1),tt.set("kilometer-per-hour",.277778),tt.set("knots",.514444),tt.set("feet-per-second",.3048),tt.set("mile-per-hour",.44704);const ft=180/Math.PI,dt=5,at=new jt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function mt(t,e){return tt.get(t)/tt.get(e)||1}function St(t){return(450-t)%360}function Ft(t,e="geographic"){const[n,o]=t,a=Math.sqrt(n*n+o*o);let i=Math.atan2(o,n)*ft;return i=(360+i)%360,e==="geographic"&&(i=St(i)),[a,i]}function Kt(t,e="geographic"){let n=t[1];e==="geographic"&&(n=St(n)),n%=360;const o=t[0];return[o*Math.cos(n/ft),o*Math.sin(n/ft)]}function Se(t,e,n,o="geographic"){if(!R(t)||n==null)return t;const a=e==="vector-magdir"?t.clone():Mt(t,e),i=a.pixels[1];for(let r=0;r<i.length;r++)i[r]=o==="geographic"?(i[r]+n[r]+270)%360:(i[r]+360-n[r])%360;return e==="vector-magdir"?a:Mt(a,"vector-magdir")}function Mt(t,e,n="geographic",o=1){if(!R(t))return t;const{pixels:a,width:i,height:r}=t,u=i*r,h=a[0],s=a[1],l=t.pixelType.startsWith("f")?t.pixelType:"f32",c=_.createEmptyBand(l,u),p=_.createEmptyBand(l,u);let f=0;for(let m=0;m<r;m++)for(let x=0;x<i;x++)e==="vector-uv"?([c[f],p[f]]=Ft([h[f],s[f]],n),c[f]*=o):([c[f],p[f]]=Kt([h[f],s[f]],n),c[f]*=o,p[f]*=o),f++;const d=new _({pixelType:l,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[c,p]});return d.updateStatistics(),d}function Fe(t,e,n=1){if(n===1||!R(t))return t;const o=t.clone(),{pixels:a,width:i,height:r}=o,u=a[0];a[1];let h=0;for(let s=0;s<r;s++)for(let l=0;l<i;l++)u[h]*=n,h++;return o.updateStatistics(),o}function Ce(t,e,n,o,a){if(a==null||!a.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(e/o),height:Math.round(n/o),resolution:t.width/e};const i=a.xmin,r=a.ymax,u=(t.xmax-t.xmin)/e*o,h=(t.ymax-t.ymin)/n*o,s=(u+h)/2;return t.xmin=i+Math.floor((t.xmin-i)/u)*u,t.xmax=i+Math.ceil((t.xmax-i)/u)*u,t.ymin=r+Math.floor((t.ymin-r)/h)*h,t.ymax=r+Math.ceil((t.ymax-r)/h)*h,{extent:t,width:Math.round(t.width/u),height:Math.round(t.height/h),resolution:s}}const Qt=Ct(0,0,0);function Ct(t=0,e=0,n=Math.PI,o=!0){o&&(n=(2*Math.PI-n)%(2*Math.PI));const a=o?-1:1,i=13*a,r=-7*a,u=-2*a,h=-16*a,s=21.75,[l,c]=N(0,e+i,n,s),[p,f]=N(t-5.5,e+r,n,s),[d,m]=N(t+5.5,e+r,n,s),[x,w]=N(t-1.5,e+u,n,s),[A,k]=N(t+1.5,e+u,n,s),[M,g]=N(t-1.5,e+h,n,s),[y,U]=N(t+1.5,e+h,n,s);return[l,c,p,f,x,w,A,k,d,m,M,g,y,U]}function Yt(t=0,e=Math.PI,n=!0){n&&(e=(2*Math.PI-e)%(2*Math.PI));const o=10,a=n?-1:1,i=5*a,r=20*a,u=25*a,h=45,s=0,l=0,c=2,p=0,f=c*a,d=n?1:-1,m=o/2*d;let[x,w]=[s+m,l-r],[A,k]=[x+c*d,w],[M,g]=[A-p*d,k+f],[y,U]=[s-m,l-u],[b,T]=[y+p*d,U-f],I=Math.ceil(t/dt),P=Math.floor(I/10);I-=8*P;const v=[],B=[];for(let z=0;z<I/2;z++,P--){P<=0&&I%2==1&&z===(I-1)/2&&(y=s,b=y+p*d,U=(U+w)/2,T=U-f);const[H,et]=N(y,U,e,h);if(P>0){const[Q,it]=N(A,U,e,h),[lt,D]=N(x,w,e,h);v.push(Q),v.push(it),v.push(H),v.push(et),v.push(lt),v.push(D)}else{const[Q,it]=N(A,k,e,h),[lt,D]=N(M,g,e,h),[E,ht]=N(b,T,e,h);B.push(H),B.push(et),B.push(E),B.push(ht),B.push(lt),B.push(D),B.push(Q),B.push(it)}U+=i,w+=i,k+=i,g+=i,T+=i}const[F,S]=N(s+m,l+r,e,h),$=(o/2+c)*d,[C,V]=N(s+$,l+r,e,h),[j,O]=N(s+m,l-u,e,h),[L,q]=N(s+$,l-u,e,h);return{pennants:v,barbs:B,shaft:[F,S,C,V,j,O,L,q]}}function N(t,e,n,o=1){const a=Math.sqrt(t*t+e*e)/o,i=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[a,(2*Math.PI+i-n)%(2*Math.PI)]}const ot=[0,1,3,6,10,16,21,27,33,40,47,55,63],Zt=[0,.5,1,1.5,2],te=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function Y(t,e,n,o){const a=mt(o||"knots",n);let i;for(i=1;i<e.length;i++)if(i===e.length-1){if(t<e[i]*a)break}else if(t<=e[i]*a)break;return Math.min(i-1,e.length-2)}function ee(t,e,n,o,a){let i=0;switch(e){case"beaufort_kn":i=Y(t,ot,"knots",n);break;case"beaufort_km":i=Y(t,ot,"kilometer-per-hour",n);break;case"beaufort_ft":i=Y(t,ot,"feet-per-second",n);break;case"beaufort_m":i=Y(t,ot,"meter-per-second",n);break;case"classified_arrow":i=Y(t,a??[],o,n);break;case"ocean_current_m":i=Y(t,Zt,"meter-per-second",n);break;case"ocean_current_kn":i=Y(t,te,"knots",n)}return i}function ne(t,e){const{style:n,inputUnit:o,outputUnit:a,breakValues:i}=e,r=at.fromJSON(o),u=at.fromJSON(a),h=7*6,s=15;let l=0,c=0;const{width:p,height:f,mask:d}=t,m=t.pixels[0],x=t.pixels[1],w=d!=null?d.filter(g=>g>0).length:p*f,A=new Float32Array(w*h),k=new Uint32Array(s*w),M=e.invertDirection?Ct(0,0,0,!1):Qt;for(let g=0;g<f;g++)for(let y=0;y<p;y++){const U=g*p+y;if(!d||d[g*p+y]){const b=(x[U]+360)%360/180*Math.PI,T=ee(m[U],n,r,u,i);for(let P=0;P<M.length;P+=2)A[l++]=(y+.5)/p,A[l++]=(g+.5)/f,A[l++]=M[P],A[l++]=M[P+1]+b,A[l++]=T,A[l++]=m[U];const I=7*(l/h-1);k[c++]=I,k[c++]=I+1,k[c++]=I+2,k[c++]=I+0,k[c++]=I+4,k[c++]=I+3,k[c++]=I+0,k[c++]=I+2,k[c++]=I+3,k[c++]=I+2,k[c++]=I+5,k[c++]=I+3,k[c++]=I+5,k[c++]=I+6,k[c++]=I+3}}return{vertexData:A,indexData:k}}const ut=[];function ie(t,e){if(ut.length===0)for(let f=0;f<30;f++)ut.push(Yt(5*f,0,!e.invertDirection));const n=mt(at.fromJSON(e.inputUnit),"knots"),{width:o,height:a,mask:i}=t,r=t.pixels[0],u=t.pixels[1],h=6,s=[],l=[];let c=0,p=0;for(let f=0;f<a;f++)for(let d=0;d<o;d++){const m=f*o+d,x=r[m]*n;if((!i||i[f*o+d])&&x>=dt){const w=(u[m]+360)%360/180*Math.PI,{pennants:A,barbs:k,shaft:M}=ut[Math.min(Math.floor(x/5),29)];if(A.length+k.length===0)continue;let g=s.length/h;const y=(d+.5)/o,U=(f+.5)/a;for(let b=0;b<A.length;b+=2)s[c++]=y,s[c++]=U,s[c++]=A[b],s[c++]=A[b+1]+w,s[c++]=0,s[c++]=x;for(let b=0;b<k.length;b+=2)s[c++]=y,s[c++]=U,s[c++]=k[b],s[c++]=k[b+1]+w,s[c++]=0,s[c++]=x;for(let b=0;b<M.length;b+=2)s[c++]=y,s[c++]=U,s[c++]=M[b],s[c++]=M[b+1]+w,s[c++]=0,s[c++]=x;for(let b=0;b<A.length/6;b++)l[p++]=g,l[p++]=g+1,l[p++]=g+2,g+=3;for(let b=0;b<k.length/8;b++)l[p++]=g,l[p++]=g+1,l[p++]=g+2,l[p++]=g+1,l[p++]=g+2,l[p++]=g+3,g+=4;l[p++]=g+0,l[p++]=g+1,l[p++]=g+2,l[p++]=g+1,l[p++]=g+3,l[p++]=g+2,g+=4}}return{vertexData:new Float32Array(s),indexData:new Uint32Array(l)}}function le(t,e){let o=0,a=0;const{width:i,height:r,mask:u}=t,h=t.pixels[0],s=[],l=[],c=mt(at.fromJSON(e.inputUnit),"knots"),p=e.style==="wind_speed"?dt:Number.MAX_VALUE;for(let f=0;f<r;f++)for(let d=0;d<i;d++){const m=h[f*i+d]*c;if((!u||u[f*i+d])&&m<p){for(let w=0;w<4;w++)s[o++]=(d+.5)/i,s[o++]=(f+.5)/r,s[o++]=w<2?-.5:.5,s[o++]=w%2==0?-.5:.5,s[o++]=0,s[o++]=m;const x=4*(o/24-1);l[a++]=x,l[a++]=x+1,l[a++]=x+2,l[a++]=x+1,l[a++]=x+2,l[a++]=x+3}}return{vertexData:new Float32Array(s),indexData:new Uint32Array(l)}}function Ve(t,e){return e.style==="simple_scalar"?le(t,e):e.style==="wind_speed"?ie(t,e):ne(t,e)}function _e(t,e,n,o=[0,0],a=.5){const{width:i,height:r,mask:u}=t,[h,s]=t.pixels,[l,c]=o,p=Math.round((i-l)/n),f=Math.round((r-c)/n),d=p*f,m=new Float32Array(d),x=new Float32Array(d),w=new Uint8Array(d);for(let k=0;k<f;k++)for(let M=0;M<p;M++){let g=0;const y=k*p+M,U=Math.max(0,k*n+c),b=Math.max(0,M*n+l),T=Math.min(r,U+n),I=Math.min(i,b+n);for(let P=U;P<T;P++)for(let v=b;v<I;v++){const B=P*i+v;if(!u||u[B]){g++;const F=[h[B],s[B]],[S,$]=F;m[y]+=S,x[y]+=$}}if(g>=(T-U)*(I-b)*(1-a)){w[y]=1;const[P,v]=Ft([m[y]/g,x[y]/g]);m[y]=P,x[y]=v}else w[y]=0,m[y]=0,x[y]=0}const A=new _({width:p,height:f,pixels:[m,x],mask:w});return A.updateStatistics(),A}const X=()=>Z.getLogger("esri.views.2d.engine.flow.dataUtils"),se=10;async function De(t,e,n,o){const a=performance.now(),i=re(e,n),r=performance.now(),u=ae(e,i,n.width,n.height),h=performance.now(),s=ce(u),l=performance.now(),c=t==="Streamlines"?ue(s,se):fe(s),p=performance.now();return nt("esri-2d-profiler")&&(X().info("I.1","_createFlowFieldFromData (ms)",Math.round(r-a)),X().info("I.2","_getStreamlines (ms)",Math.round(h-r)),X().info("I.3","createAnimatedLinesData (ms)",Math.round(l-h)),X().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(p-l)),X().info("I.5","createFlowMesh (ms)",Math.round(p-a)),X().info("I.6","Mesh size (bytes)",c.vertexData.buffer.byteLength+c.indexData.buffer.byteLength)),await Promise.resolve(),Nt(o),c}function re(t,e){const n=he(e.data,e.width,e.height,t.smoothing);return t.interpolate?(o,a)=>{const i=Math.floor(o),r=Math.floor(a);if(i<0||i>=e.width)return[0,0];if(r<0||r>=e.height)return[0,0];const u=o-i,h=a-r,s=i,l=r,c=i<e.width-1?i+1:i,p=r<e.height-1?r+1:r,f=n[2*(l*e.width+s)],d=n[2*(l*e.width+c)],m=n[2*(p*e.width+s)],x=n[2*(p*e.width+c)],w=n[2*(l*e.width+s)+1],A=n[2*(l*e.width+c)+1];return[(f*(1-h)+m*h)*(1-u)+(d*(1-h)+x*h)*u,(w*(1-h)+n[2*(p*e.width+s)+1]*h)*(1-u)+(A*(1-h)+n[2*(p*e.width+c)+1]*h)*u]}:(o,a)=>{const i=Math.round(o),r=Math.round(a);return i<0||i>=e.width||r<0||r>=e.height?[0,0]:[n[2*(r*e.width+i)],n[2*(r*e.width+i)+1]]}}function oe(t,e,n,o,a,i,r,u,h){const s=[];let l=n,c=o,p=0,[f,d]=e(l,c);f*=t.velocityScale,d*=t.velocityScale;const m=Math.sqrt(f*f+d*d);let x,w;s.push({x:l,y:c,t:p,speed:m});for(let A=0;A<t.verticesPerLine;A++){let[k,M]=e(l,c);k*=t.velocityScale,M*=t.velocityScale;const g=Math.sqrt(k*k+M*M);if(g<t.minSpeedThreshold)return s;const y=k/g,U=M/g;if(l+=y*t.segmentLength,c+=U*t.segmentLength,p+=t.segmentLength/g,Math.acos(y*x+U*w)>t.maxTurnAngle)return s;if(t.collisions){const b=Math.round(l*h),T=Math.round(c*h);if(b<0||b>r-1||T<0||T>u-1)return s;const I=i[T*r+b];if(I!==-1&&I!==a)return s;i[T*r+b]=a}s.push({x:l,y:c,t:p,speed:g}),x=y,w=U}return s}function ae(t,e,n,o){const a=[],i=new vt,r=1/Math.max(t.lineCollisionWidth,1),u=Math.round(n*r),h=Math.round(o*r),s=new Int32Array(u*h);for(let c=0;c<s.length;c++)s[c]=-1;const l=[];for(let c=0;c<o;c+=t.lineSpacing)for(let p=0;p<n;p+=t.lineSpacing)l.push({x:p,y:c,sort:i.getFloat()});l.sort((c,p)=>c.sort-p.sort);for(const{x:c,y:p}of l)if(i.getFloat()<t.density){const f=oe(t,e,c,p,a.length,s,u,h,r);if(f.length<2)continue;a.push(f)}return a}function he(t,e,n,o){if(o===0)return t;const a=Math.round(3*o),i=new Array(2*a+1);let r=0;for(let s=-a;s<=a;s++){const l=Math.exp(-s*s/(o*o));i[s+a]=l,r+=l}for(let s=-a;s<=a;s++)i[s+a]/=r;const u=new Float32Array(t.length);for(let s=0;s<n;s++)for(let l=0;l<e;l++){let c=0,p=0;for(let f=-a;f<=a;f++){if(l+f<0||l+f>=e)continue;const d=i[f+a];c+=d*t[2*(s*e+(l+f))],p+=d*t[2*(s*e+(l+f))+1]}u[2*(s*e+l)]=c,u[2*(s*e+l)+1]=p}const h=new Float32Array(t.length);for(let s=0;s<e;s++)for(let l=0;l<n;l++){let c=0,p=0;for(let f=-a;f<=a;f++){if(l+f<0||l+f>=n)continue;const d=i[f+a];c+=d*u[2*((l+f)*e+s)],p+=d*u[2*((l+f)*e+s)+1]}h[2*(l*e+s)]=c,h[2*(l*e+s)+1]=p}return h}function ce(t,e){const n=new vt,o=t.reduce((h,s)=>h+s.length,0),a=new Float32Array(4*o),i=new Array(t.length);let r=0,u=0;for(const h of t){const s=r;for(const l of h)a[4*r]=l.x,a[4*r+1]=l.y,a[4*r+2]=l.t,a[4*r+3]=l.speed,r++;i[u++]={startVertex:s,numberOfVertices:h.length,totalTime:h[h.length-1].t,timeSeed:n.getFloat()}}return{lineVertices:a,lineDescriptors:i}}function ue(t,e){const{lineVertices:o,lineDescriptors:a}=t;let i=0,r=0;for(const f of a)i+=2*f.numberOfVertices,r+=6*(f.numberOfVertices-1);const u=new Float32Array(i*9),h=new Uint32Array(r);let s=0,l=0;function c(){h[l++]=s-2,h[l++]=s,h[l++]=s-1,h[l++]=s,h[l++]=s+1,h[l++]=s-1}function p(f,d,m,x,w,A,k,M){const g=s*9;let y=0;u[g+y++]=f,u[g+y++]=d,u[g+y++]=1,u[g+y++]=m,u[g+y++]=A,u[g+y++]=k,u[g+y++]=x/2,u[g+y++]=w/2,u[g+y++]=M,s++,u[g+y++]=f,u[g+y++]=d,u[g+y++]=-1,u[g+y++]=m,u[g+y++]=A,u[g+y++]=k,u[g+y++]=-x/2,u[g+y++]=-w/2,u[g+y++]=M,s++}for(const f of a){const{totalTime:d,timeSeed:m}=f;let x=null,w=null,A=null,k=null,M=null,g=null;for(let y=0;y<f.numberOfVertices;y++){const U=o[4*(f.startVertex+y)],b=o[4*(f.startVertex+y)+1],T=o[4*(f.startVertex+y)+2],I=o[4*(f.startVertex+y)+3];let P=null,v=null,B=null,F=null;if(y>0){P=U-x,v=b-w;const S=Math.sqrt(P*P+v*v);if(P/=S,v/=S,y>1){let $=P+M,C=v+g;const V=Math.sqrt($*$+C*C);$/=V,C/=V;const j=Math.min(1/($*P+C*v),e);$*=j,C*=j,B=-C,F=$}else B=-v,F=P;B!==null&&F!==null&&(p(x,w,A,B,F,d,m,I),c())}x=U,w=b,A=T,M=P,g=v,k=I}p(x,w,A,-g,M,d,m,k)}return{vertexData:u,indexData:h}}function fe(t){const{lineVertices:a,lineDescriptors:i}=t;let r=0,u=0;for(const S of i){const $=S.numberOfVertices-1;r+=4*$*2,u+=6*$*2}const h=new Float32Array(r*16),s=new Uint32Array(u);let l,c,p,f,d,m,x,w,A,k,M,g,y,U,b=0,T=0;function I(){s[T++]=b-8,s[T++]=b-7,s[T++]=b-6,s[T++]=b-7,s[T++]=b-5,s[T++]=b-6,s[T++]=b-4,s[T++]=b-3,s[T++]=b-2,s[T++]=b-3,s[T++]=b-1,s[T++]=b-2}function P(S,$,C,V,j,O,L,q,z,H,et,Q,it,lt){const D=b*16;let E=0;for(const ht of[1,2])for(const Vt of[1,2,3,4])h[D+E++]=S,h[D+E++]=$,h[D+E++]=C,h[D+E++]=V,h[D+E++]=L,h[D+E++]=q,h[D+E++]=z,h[D+E++]=H,h[D+E++]=ht,h[D+E++]=Vt,h[D+E++]=it,h[D+E++]=lt,h[D+E++]=j/2,h[D+E++]=O/2,h[D+E++]=et/2,h[D+E++]=Q/2,b++}function v(S,$){let C=A+M,V=k+g;const j=Math.sqrt(C*C+V*V);C/=j,V/=j;const O=A*C+k*V;C/=O,V/=O;let L=M+y,q=g+U;const z=Math.sqrt(L*L+q*q);L/=z,q/=z;const H=M*L+g*q;L/=H,q/=H,P(l,c,p,f,-V,C,d,m,x,w,-q,L,S,$),I()}function B(S,$,C,V,j,O){if(A=M,k=g,M=y,g=U,A==null&&k==null&&(A=M,k=g),d!=null&&m!=null){y=S-d,U=$-m;const L=Math.sqrt(y*y+U*U);y/=L,U/=L}A!=null&&k!=null&&v(j,O),l=d,c=m,p=x,f=w,d=S,m=$,x=C,w=V}function F(S,$){A=M,k=g,M=y,g=U,A==null&&k==null&&(A=M,k=g),A!=null&&k!=null&&v(S,$)}for(const S of i){l=null,c=null,p=null,f=null,d=null,m=null,x=null,w=null,A=null,k=null,M=null,g=null,y=null,U=null;const{totalTime:$,timeSeed:C}=S;for(let V=0;V<S.numberOfVertices;V++)B(a[4*(S.startVertex+V)],a[4*(S.startVertex+V)+1],a[4*(S.startVertex+V)+2],a[4*(S.startVertex+V)+3],$,C);F($,C)}return{vertexData:h,indexData:s}}function At(t,e){const n=e.pixels,{width:o,height:a}=e,i=new Float32Array(o*a*2),r=e.mask||new Uint8Array(o*a*2);if(e.mask||r.fill(255),t==="vector-uv")for(let u=0;u<o*a;u++)i[2*u]=n[0][u],i[2*u+1]=-n[1][u];else if(t==="vector-magdir")for(let u=0;u<o*a;u++){const h=n[0][u],s=Ot(n[1][u]),l=Math.cos(s-Math.PI/2),c=Math.sin(s-Math.PI/2);i[2*u]=l*h,i[2*u+1]=c*h}return{data:i,mask:r,width:o,height:a}}async function Re(t,e,n,o,a,i){const r=performance.now(),u=Gt(e.spatialReference);if(!u){const M=await bt(t,e,n,o,a,i);return nt("esri-2d-profiler")&&X().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-r)),nt("esri-2d-profiler")&&X().info("I.9","Number of parts",1),M}const[h,s]=u.valid,l=s-h,c=Math.ceil(e.width/l),p=e.width/c,f=Math.round(n/c);let d=e.xmin;const m=[],x=performance.now();for(let M=0;M<c;M++){const g=new qt({xmin:d,xmax:d+p,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});m.push(bt(t,g,f,o,a,i)),d+=p}const w=await Promise.all(m);nt("esri-2d-profiler")&&X().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-x)),nt("esri-2d-profiler")&&X().info("I.9","Number of parts",w.length);const A={data:new Float32Array(n*o*2),mask:new Uint8Array(n*o),width:n,height:o};let k=0;for(const M of w){for(let g=0;g<M.height;g++)for(let y=0;y<M.width;y++)k+y>=n||(A.data[2*(g*n+k+y)]=M.data[2*(g*M.width+y)],A.data[2*(g*n+k+y)+1]=M.data[2*(g*M.width+y)+1],A.mask[g*n+k+y]=M.mask[g*M.width+y]);k+=M.width}return nt("esri-2d-profiler")&&X().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-r)),A}async function bt(t,e,n,o,a,i){var s;const r={requestProjectedLocalDirections:!0,signal:i};if(a!=null&&(r.timeExtent=a),t.type==="imagery"){await t.load({signal:i});const l=t.rasterInfo.dataType,c=await t.fetchImage(e,n,o,r);return((s=c==null?void 0:c.pixelData)==null?void 0:s.pixelBlock)==null?{data:new Float32Array(n*o*2),mask:new Uint8Array(n*o),width:n,height:o}:At(l,c.pixelData.pixelBlock)}await t.load({signal:i});const u=t.serviceRasterInfo.dataType,h=await t.fetchPixels(e,n,o,r);return(h==null?void 0:h.pixelBlock)==null?{data:new Float32Array(n*o*2),mask:new Uint8Array(n*o),width:n,height:o}:At(u,h.pixelBlock)}export{Be as D,Ie as E,Ue as M,It as P,$e as R,_e as S,Pe as T,Ve as U,Te as W,le as _,_ as a,ye as b,xe as c,xt as d,Ae as e,Mt as f,Re as g,we as h,me as i,Pt as j,Jt as k,Ut as l,Ce as m,gt as n,R as o,Me as p,Se as q,ge as r,De as s,at as t,ke as u,mt as v,ve as w,Fe as x,be as y,Ft as z};
