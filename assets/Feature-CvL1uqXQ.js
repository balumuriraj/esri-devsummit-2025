const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BYYG-xAB.js","assets/index-CSP37mtf.css","assets/index-BUoYXUT-.js","assets/customElement-C3Q54q-_.js","assets/index-DhVZbVWa.js","assets/input-DXXlUtOs.js","assets/key-CZcQa38B.js","assets/index-Eq-Toaef.js","assets/Validation-DpEX_57_.js","assets/form-BSrwdpUC.js","assets/label-rGH0IiJo.js","assets/filter-CYJLG1JG.js","assets/debounce-D0G5qrda.js","assets/utils-6jl7yWT_.js","assets/index-vWjR11Qv.js","assets/index-IBLU58WV.js","assets/floating-ui-BY8xL-Mq.js","assets/openCloseComponent-CLvE7Mo7.js","assets/dynamicClasses-pKEMtFzB.js","assets/index-CdSLHcQn.js","assets/resources6-Cs2_VmEC.js","assets/index-BxYxfIsk.js","assets/customElement-B0I8rvOB.js","assets/resources5-SciNIBSe.js","assets/index-CNBosper.js","assets/uniqueValues-Cf_hQO5o.js","assets/CodeBlock-DBIw63CI.js","assets/CodeBlock-CnI_Xe9l.css","assets/utils-DaanhY3M.js","assets/quantizationUtils-yHnQ7Pvp.js","assets/utils-Cxh3ySg9.js","assets/utils-DduwN48O.js","assets/ClassBreaksDefinition-C9GT6nmE.js","assets/executeQueryJSON-DvU8JPk7.js","assets/query-DTz_QEX_.js","assets/pbfQueryUtils-CBubhGp0.js","assets/pbf-Ckxyvybt.js","assets/memoryEstimations-DG877__o.js","assets/OptimizedFeature-C7vq2Etq.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/statsWorker-D_0Y5cYK.js","assets/AttributeBinsQuery-DRtWrz9a.js","assets/queryUtils-B4LAuMaE.js","assets/json-Wa8cmqdu.js","assets/FixedIntervalBinParameters-KycFlU6D.js","assets/chartUtilsAm5-DbmtZU2A.js","assets/Theme-CtxoBIlb.js","assets/Tooltip-BDsCl9Ny.js","assets/DefaultTheme-BpZBqhFl.js","assets/chartCommon-BLhzEe9n.js","assets/Button-D4G8yJna.js","assets/ColorSet-Dd8N1355.js","assets/pieChart-CA47eCrq.js","assets/Tick-T_M52aTY.js","assets/xyChart-Wg9Vaye3.js","assets/arcade-CkApeXxD.js","assets/ImmutableArray-BPVd6ESQ.js","assets/TimeOnly-tuNXHBy1.js","assets/arcade-BgfxPaiF.js","assets/unitConversion-6ZpUFgaF.js","assets/shared-DXU12d8O.js","assets/number-CfiTeRlm.js","assets/featureConversionUtils-CKmftsHB.js","assets/WhereClause-DVOvsAur.js","assets/index-C_HaIepg.js","assets/FeatureUtilityNetworkAssociationList-DRYUj-Jm.js","assets/substitute-yjuxyp9K.js","assets/AttachmentInfo-CAtThIQa.js","assets/featureUtils-CSVZmTHB.js","assets/widget-D7ZMvL-q.js","assets/utils-DELMN4i8.js","assets/cimSymbolUtils-BKUa-w8i.js"])))=>i.map(i=>d[i]);
import{_ as F}from"./index-BYYG-xAB.js";import{b4 as oe,aI as J,cu as L,f9 as N,ae as P,jx as Ct,i as a,k as l,q as we,aK as Ae,qr as Ai,o as V,f8 as Ii,iR as re,f7 as We,iS as Ie,iT as h,iU as $,qs as Mt,qt as Ft,qu as Ci,pq as Ce,pv as he,iQ as ee,qv as $t,pt as ei,b2 as ti,b3 as mt,it as xe,fZ as ke,qw as Tt,bS as Mi,aD as De,e3 as Fi,fc as ii,hE as Qe,b5 as Le,iE as ct,m8 as $i,qx as si,r as Et,l as ut,bx as ri,qy as Ti,lI as yt,cz as Ei,gp as xi,n as Xe,at as be,e9 as ki,a9 as Li,dL as Ri,qz as Si,qA as Oi,qB as Pi,dp as Vi,fb as ni,kt as se,fB as Ke,aa as $e,qC as qi,qD as ai,qE as Ni,qF as Di,v as oi,h8 as ji,ps as Bi,b9 as xt,eQ as Ui,lK as kt,a1 as Hi}from"./CodeBlock-DBIw63CI.js";import{a as zi}from"./AttachmentInfo-CAtThIQa.js";import{getSourceLayer as li,findUtilityNetwork as Wi,getFixedFieldName as ht,isRelatableFeatureSupportedLayer as di,findRelatedLayer as Qi,graphicCallback as Ye,shouldOpenInNewTab as ci,getFieldInfoLabel as ui,isRelatedField as pe,substituteFieldsInLinksAndAttributes as me,fixTokens as Lt,substituteAttributes as Rt,getFixedFieldNames as Xi,isExpressionField as hi,getFieldInfo as Ki,applyTextFormattingHTML as ft,htmlEntities as gt,createFieldInfoMap as Yi,getAllFieldInfos as St,querySourceLayer as Zi,queryUpdatedFeature as Gi,isAssociatedFeatureSupportedLayer as Ji,formatEditInfo as es,formatAttributes as et,preLayerQueryCallback as ts,preRequestCallback as is}from"./featureUtils-CSVZmTHB.js";import{e as pi,t as ss}from"./widget-D7ZMvL-q.js";import{h as fe}from"./utils-DELMN4i8.js";import{s as tt}from"./executeQueryJSON-DvU8JPk7.js";import{s as _t}from"./substitute-yjuxyp9K.js";import{x as rs}from"./shared-DXU12d8O.js";const Ot={editing:!1,operations:{add:!0,update:!0,delete:!0}},mi=J.ofType(zi);let W=class extends oe{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...Ot},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new mi,this.fileInfos=new J,this.graphic=null,this.mode="view",this.orderByFields=null,this.filesEnabled=!1,this.addHandles(L(()=>this.graphic,()=>this._graphicChanged(),N))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return{...Ot,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const i=e.layer||e.sourceLayer;return(i==null?void 0:i.loaded)&&"capabilities"in i&&i.capabilities&&"attachment"in i.capabilities&&i.capabilities.attachment&&"supportsResize"in i.capabilities.attachment&&i.capabilities.attachment.supportsResize||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:i,orderByFields:s}=this;if(!e||typeof e.queryAttachments!="function")throw new P("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId();if(typeof r!="number")throw new P("invalid-object-id","getAttachments(): Numeric object id is required");const n=s==null?void 0:s.map(p=>`${p.field} ${p.order==="descending"?"DESC":"ASC"}`),o=new Ct({objectIds:[r],returnMetadata:!0,orderByFields:n}),d=[],c=e.queryAttachments(o).then(p=>p[r]||d).catch(()=>d);this._getAttachmentsPromise=c,this.notifyChange("state");const u=await c;return i.destroyAll(),u.length&&i.addMany(u),this._getAttachmentsPromise=null,this.notifyChange("state"),u}async addAttachment(e,i=this.graphic){var c;const{_attachmentLayer:s,attachmentInfos:r,capabilities:n}=this;if(!i)throw new P("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:i});if(!e)throw new P("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((c=n.operations)!=null&&c.add))throw new P("invalid-capabilities","addAttachment(): add capabilities are required.");if(!s||typeof s.addAttachment!="function")throw new P("invalid-layer","addAttachment(): A valid layer is required.");const o=s.addAttachment(i,e).then(u=>this._queryAttachment(u.objectId,i)),d=await o;return r.add(d),d}async deleteAttachment(e){var c;const{_attachmentLayer:i,attachmentInfos:s,graphic:r,capabilities:n}=this;if(!e)throw new P("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((c=n.operations)!=null&&c.delete))throw new P("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!i||typeof i.deleteAttachments!="function")throw new P("invalid-layer","deleteAttachment(): A valid layer is required.");if(!r)throw new P("invalid-graphic","deleteAttachment(): A graphic is required.");const o=i.deleteAttachments(r,[e.id]).then(()=>e),d=await o;return s.remove(d),d.destroy(),d}async updateAttachment(e,i=this.activeAttachmentInfo){var p;const{_attachmentLayer:s,attachmentInfos:r,graphic:n,capabilities:o}=this;if(!e)throw new P("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!i)throw new P("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:i});if(!((p=o.operations)!=null&&p.update))throw new P("invalid-capabilities","updateAttachment(): Update capabilities are required.");const d=r.indexOf(i);if(!s||typeof s.updateAttachment!="function")throw new P("invalid-layer","updateAttachment(): A valid layer is required.");if(!n)throw new P("invalid-graphic","updateAttachment(): A graphic is required.");const c=s.updateAttachment(n,i.id,e).then(m=>this._queryAttachment(m.objectId)),u=await c;return r.splice(d,1,u),u}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,i){if(!e||!i)return null;const s={file:e,form:i};return this.fileInfos.add(s),s}updateFile(e,i,s=this.activeFileInfo){if(!e||!i||!s)return null;const r=this.fileInfos.indexOf(s);return r>-1&&this.fileInfos.splice(r,1,{file:e,form:i}),this.fileInfos.items[r]}deleteFile(e){const i=this.fileInfos.find(s=>s.file===e);return i?(this.fileInfos.remove(i),i):null}async _queryAttachment(e,i){const{_attachmentLayer:s}=this;if(!e||!(s!=null&&s.queryAttachments))throw new P("invalid-attachment-id","Could not query attachment.");const r=this._getObjectId(i);if(typeof r!="number")throw new P("invalid-object-id","getAttachments(): Numeric object id is required");const n=new Ct({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return s.queryAttachments(n).then(o=>o[r][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>this.attachmentInfos.destroyAll()))}_setAttachmentLayer(){const{graphic:e}=this,i=li(e);this._attachmentLayer=i?i.type==="scene"&&i.associatedLayer!=null?i.associatedLayer:i:null}};a([l()],W.prototype,"capabilities",void 0),a([we("capabilities")],W.prototype,"castCapabilities",null),a([l()],W.prototype,"activeAttachmentInfo",void 0),a([l()],W.prototype,"activeFileInfo",void 0),a([l({readOnly:!0,type:mi})],W.prototype,"attachmentInfos",void 0),a([l()],W.prototype,"fileInfos",void 0),a([l({type:Ae})],W.prototype,"graphic",void 0),a([l()],W.prototype,"mode",void 0),a([l({type:[Ai]})],W.prototype,"orderByFields",void 0),a([l({readOnly:!0})],W.prototype,"state",null),a([l()],W.prototype,"filesEnabled",void 0),a([l({readOnly:!0})],W.prototype,"supportsResizeAttachments",null),W=a([V("esri.widgets.Attachments.AttachmentsViewModel")],W);const vt=W;function Pt(t){const e=t.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function ns(t){const e=Ii("esri/themes/base/images/files/");return t?t==="text/plain"?`${e}text-32.svg`:t==="application/pdf"?`${e}pdf-32.svg`:t==="text/csv"?`${e}csv-32.svg`:t==="application/gpx+xml"?`${e}gpx-32.svg`:t==="application/x-dwf"?`${e}cad-32.svg`:t==="application/postscript"||t==="application/json"||t==="text/xml"||t==="model/vrml"?`${e}code-32.svg`:t==="application/x-zip-compressed"||t==="application/x-7z-compressed"||t==="application/x-gzip"||t==="application/x-tar"||t==="application/x-gtar"||t==="application/x-bzip2"||t==="application/gzip"||t==="application/x-compress"||t==="application/x-apple-diskimage"||t==="application/x-rar-compressed"||t==="application/zip"?`${e}zip-32.svg`:t.includes("image/")?`${e}image-32.svg`:t.includes("audio/")?`${e}sound-32.svg`:t.includes("video/")?`${e}video-32.svg`:t.includes("msexcel")||t.includes("ms-excel")||t.includes("spreadsheetml")?`${e}excel-32.svg`:t.includes("msword")||t.includes("ms-word")||t.includes("wordprocessingml")?`${e}word-32.svg`:t.includes("powerpoint")||t.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}const Vt={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},T="esri-attachments",A={base:T,loaderContainer:`${T}__loader-container`,loader:`${T}__loader`,container:`${T}__container`,containerList:`${T}__container--list`,containerPreview:`${T}__container--preview`,actions:`${T}__actions`,deleteButton:`${T}__delete-button`,addAttachmentButton:`${T}__add-attachment-button`,errorMessage:`${T}__error-message`,items:`${T}__items`,item:`${T}__item`,itemButton:`${T}__item-button`,itemMask:`${T}__item-mask`,itemMaskIcon:`${T}__item-mask--icon`,itemImage:`${T}__image`,itemImageResizable:`${T}__image--resizable`,itemLabel:`${T}__label`,itemFilename:`${T}__filename`,itemChevronIcon:`${T}__item-chevron-icon`,itemLink:`${T}__item-link`,itemLinkOverlay:`${T}__item-link-overlay`,itemLinkOverlayIcon:`${T}__item-link-overlay-icon`,itemAddIcon:`${T}__item-add-icon`,formNode:`${T}__form-node`,fileFieldset:`${T}__file-fieldset`,fileLabel:`${T}__file-label`,fileName:`${T}__file-name`,fileInput:`${T}__file-input`,metadata:`${T}__metadata`,metadataFieldset:`${T}__metadata-fieldset`,progressBar:`${T}__progress-bar`},it=window.CSS;let B=class extends re{constructor(e,i){super(e,i),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...Vt},this._supportsImageOrientation=it&&it.supports&&it.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e!=null&&e.viewModel||(e={viewModel:new vt,...e}),e}initialize(){this.addHandles([We(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),We(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),L(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),N)])}loadDependencies(){return Ie({icon:()=>F(()=>import("./index-BYYG-xAB.js").then(e=>e.av),__vite__mapDeps([0,1]))})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...Vt,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.addAttachment(e).then(s=>(this._set("submitting",!1),this._set("error",null),i.mode="view",s)).catch(s=>{throw this._set("submitting",!1),this._set("error",new P("attachments:add-attachment",this.messages.addErrorMessage,s)),s})}deleteAttachment(e){const{viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.deleteAttachment(e).then(s=>(this._set("submitting",!1),this._set("error",null),i.mode="view",s)).catch(s=>{throw this._set("submitting",!1),this._set("error",new P("attachments:delete-attachment",this.messages.deleteErrorMessage,s)),s})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:i}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(i).then(s=>(this._set("submitting",!1),this._set("error",null),e.mode="view",s)).catch(s=>{throw this._set("submitting",!1),this._set("error",new P("attachments:update-attachment",this.messages.updateErrorMessage,s)),s})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,i=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",i}deleteFile(e){var s;const i=this.viewModel.deleteFile(e||((s=this.viewModel.activeFileInfo)==null?void 0:s.file));return this.viewModel.mode="view",i}render(){const{submitting:e,viewModel:i}=this,{state:s}=i;return h("div",{class:this.classes(A.base,$.widget)},e?this._renderProgressBar():null,s==="loading"?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:e,visibleElements:i}=this;return e&&i.errorMessage?h("div",{class:A.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){const{activeFileInfo:e,mode:i,activeAttachmentInfo:s}=this.viewModel;return i==="add"?this._renderAddForm():i==="edit"?this._renderDetailsForm(s||e):this._renderAttachmentContainer()}_renderLoading(){return h("div",{class:A.loaderContainer,key:"loader"},h("div",{class:A.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?h("div",{class:A.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:e,selectedFile:i}=this,s=e||!i,r=this.visibleElements.cancelAddButton?h("button",{bind:this,class:this.classes($.button,$.buttonTertiary,$.buttonSmall,$.buttonHalf,e&&$.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?h("button",{class:this.classes($.button,$.buttonSecondary,$.buttonSmall,$.buttonHalf,{[$.buttonDisabled]:s}),disabled:s,type:"submit"},this.messages.add):null,o=i?h("span",{class:A.fileName,key:"file-name"},i.name):null,d=h("form",{afterCreate:Ft,afterRemoved:Mt,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},h("fieldset",{class:A.fileFieldset},o,h("label",{class:this.classes(A.fileLabel,$.button,$.buttonSecondary)},i?this.messages.changeFile:this.messages.selectFile,h("input",{bind:this,class:A.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),n,r);return h("div",{class:A.formNode,key:"add-form-container"},d)}_renderDetailsForm(e){var k,x,R;const{visibleElements:i,viewModel:s,selectedFile:r,submitting:n}=this,{capabilities:o}=s,d=n||!r;let c,u,p,m;r?(c=r.type,u=r.name,p=r.size):e&&"file"in e?(c=e.file.type,u=e.file.name,p=e.file.size):e&&"contentType"in e&&(c=e.contentType,u=e.name,p=e.size,m=e.url);const y=o.editing&&((k=o.operations)!=null&&k.delete)&&i.deleteButton?h("button",{bind:this,class:this.classes($.button,$.buttonSmall,$.buttonTertiary,A.deleteButton,{[$.buttonDisabled]:n}),disabled:n,key:"delete-button",onclick:U=>this._submitDeleteAttachment(U,e),type:"button"},this.messages.delete):void 0,f=o.editing&&((x=o.operations)!=null&&x.update)&&i.updateButton?h("button",{class:this.classes($.button,$.buttonSmall,$.buttonThird,{[$.buttonDisabled]:d}),disabled:d,key:"update-button",type:"submit"},this.messages.update):void 0,g=this.visibleElements.cancelUpdateButton?h("button",{bind:this,class:this.classes($.button,$.buttonSmall,$.buttonTertiary,$.buttonThird,{[$.buttonDisabled]:n}),disabled:n,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,_=o.editing&&((R=o.operations)!=null&&R.update)?h("fieldset",{class:A.fileFieldset,key:"file"},h("span",{class:A.fileName,key:"file-name"},u),h("label",{class:this.classes(A.fileLabel,$.button,$.buttonSecondary)},this.messages.changeFile,h("input",{bind:this,class:A.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,v=h("fieldset",{class:A.metadataFieldset,key:"size"},h("label",null,Ci(this.messagesUnits,p??0))),b=h("fieldset",{class:A.metadataFieldset,key:"content-type"},h("label",null,c)),w=m!=null?h("a",{class:A.itemLink,href:m,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),h("div",{class:A.itemLinkOverlay},h("span",{class:A.itemLinkOverlayIcon},h("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),I=h("form",{afterCreate:Ft,afterRemoved:Mt,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:U=>this._submitUpdateAttachment(U,e)},h("div",{class:A.metadata},v,b),_,h("div",{class:A.actions},y,g,f));return h("div",{class:A.formNode,key:"edit-form-container"},w,I)}_renderImageMask(e,i){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,i):null}_renderGenericImageMask(e,i){const{supportsResizeAttachments:s}=this.viewModel,r=ns(i),n={[A.itemImageResizable]:s};return h("div",{class:this.classes(A.itemMaskIcon,A.itemMask),key:r},h("img",{alt:e,class:this.classes(n,A.itemImage),src:r,title:e}))}_renderImageMaskForAttachment(e,i){const{supportsResizeAttachments:s}=this.viewModel;if(!e)return null;const{contentType:r,name:n,url:o}=e;if(!s||!Pt(r))return this._renderGenericImageMask(n,r);const d=this._getCSSTransform(e),c=d?{transform:d,"image-orientation":"none"}:{},u=`${o}${o!=null&&o.includes("?")?"&":"?"}w=${i}`,p={[A.itemImageResizable]:s};return h("div",{class:this.classes(A.itemMask),key:u},h("img",{alt:n,class:this.classes(p,A.itemImage),src:u,styles:c,title:n}))}_renderFile(e){const{file:i}=e;return h("li",{class:A.item,key:i},h("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:A.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),h("label",{class:A.itemLabel},h("span",{class:A.itemFilename},i.name||this.messages.noTitle),h("span",{"aria-hidden":"true",class:this.classes(A.itemChevronIcon,he(this.container)?Ce.left:Ce.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:i}){const{viewModel:s,effectiveDisplayType:r}=this,{capabilities:n,supportsResizeAttachments:o}=s,{contentType:d,name:c,url:u}=e,p=this._renderImageMask(e,i==="list"?48:400),m=n.editing?h("span",{"aria-hidden":"true",class:this.classes(A.itemChevronIcon,he(this.container)?Ce.left:Ce.right)}):null,y=[p,r==="preview"&&o&&Pt(d)?null:h("label",{class:A.itemLabel},h("span",{class:A.itemFilename},c||this.messages.noTitle),m)],f=n.editing?h("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:A.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},y):h("a",{class:A.itemButton,href:u??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},y);return h("li",{class:A.item,key:e},f)}_renderAttachmentContainer(){var g;const{effectiveDisplayType:e,viewModel:i,visibleElements:s}=this,{attachmentInfos:r,capabilities:n,fileInfos:o}=i,d=!!(r!=null&&r.length),c=!!(o!=null&&o.length),u={[A.containerList]:e!=="preview",[A.containerPreview]:e==="preview"},p=n.editing&&((g=n.operations)!=null&&g.add)&&s.addButton?h("button",{bind:this,class:this.classes($.button,$.buttonTertiary,A.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},h("span",{"aria-hidden":"true",class:this.classes(A.itemAddIcon,Ce.plus)}),this.messages.add):void 0,m=d?h("ul",{class:A.items,key:"attachments-list"},r.toArray().map(_=>this._renderAttachmentInfo({attachmentInfo:_,displayType:e}))):void 0,y=c?h("ul",{class:A.items,key:"file-list"},o.toArray().map(_=>this._renderFile(_))):void 0,f=c||d?void 0:h("div",{class:$.empty},this.messages.noAttachments);return h("div",{class:this.classes(A.container,u),key:"attachments-container"},m,y,f,p)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){var r;const i=e.target,s=(r=i.files)==null?void 0:r.item(0);this._set("selectedFile",s)}_submitDeleteAttachment(e,i){e.preventDefault(),i&&("file"in i?this.deleteFile(i.file):i&&this.deleteAttachment(i))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,i){e.preventDefault(),i&&"file"in i?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:i}=this;i.activeFileInfo=null,i.activeAttachmentInfo=e,i.mode="edit"}_startEditFile(e){const{viewModel:i}=this;i.activeAttachmentInfo=null,i.activeFileInfo=e,i.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};a([l()],B.prototype,"capabilities",null),a([l()],B.prototype,"displayType",void 0),a([l({readOnly:!0})],B.prototype,"effectiveDisplayType",null),a([l()],B.prototype,"graphic",null),a([l()],B.prototype,"icon",null),a([l()],B.prototype,"label",null),a([l(),ee("esri/widgets/Attachments/t9n/Attachments")],B.prototype,"messages",void 0),a([l(),ee("esri/core/t9n/Units")],B.prototype,"messagesUnits",void 0),a([l({readOnly:!0})],B.prototype,"selectedFile",void 0),a([l({readOnly:!0})],B.prototype,"submitting",void 0),a([l({readOnly:!0})],B.prototype,"error",void 0),a([l({type:vt})],B.prototype,"viewModel",void 0),a([l()],B.prototype,"visibleElements",void 0),a([we("visibleElements")],B.prototype,"castVisibleElements",null),B=a([V("esri.widgets.Attachments")],B);const as=B;var qt,Nt;(function(t){t.Text="text",t.Number="number",t.Date="date",t.Unsupported="unsupported"})(qt||(qt={})),function(t){t.CANNOT_BE_EMPTY="input-validation-error::cannot-be-empty",t.TOO_SHORT="length-validation-error::too-short",t.TOO_LONG="length-validation-error::too-long"}(Nt||(Nt={}));const os=t=>{var i;const e=[];if(t.formTemplate){const{description:s,title:r}=t.formTemplate;(i=t.fields)==null||i.forEach(n=>{const o=r&&$t(r,n.name),d=s&&$t(s,n.name);(o||d)&&e.push(n.name)})}return e};let Te=class extends oe{constructor(e){super(e),this.title=!0,this.description=!0}};a([l({type:Boolean,nonNullable:!0})],Te.prototype,"title",void 0),a([l({type:Boolean,nonNullable:!0})],Te.prototype,"description",void 0),Te=a([V("esri.widgets.Feature.FeatureUtilityNetworkAssociations.VisibleElements")],Te);const yi=Te,st="esri-feature-element-info",rt={base:st,title:`${st}__title`,description:`${st}__description`};let ge=class extends re{constructor(e,i){super(e,i),this.description=null,this.headingLevel=2,this.title=null}render(){return h("div",{class:rt.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:e}=this;return e?h(ei,{class:rt.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){const{description:e}=this;return e?h("div",{class:rt.description,innerHTML:e,key:"description"}):null}};a([l()],ge.prototype,"description",void 0),a([l()],ge.prototype,"headingLevel",void 0),a([l()],ge.prototype,"title",void 0),ge=a([V("esri.widgets.Feature.support.FeatureElementInfo")],ge);const Re=ge,Pe={assetGroup:"assetgroup",assetType:"assettype"},Dt=100;let C=class extends ti.ClonableMixin(mt.IdentifiableMixin(oe)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.networkSourceIdsInUse=new Set,this.source="popup",this.description=null,this.graphic=null,this.layer=null,this.map=null,this.featureCount=0,this.associationTypes=null,this.showAllEnabled=!1,this.title=null,this.attachmentsFeatureCount=0,this.structureFeatureCount=0,this.contentFeatureCount=0,this.containerFeatureCount=0,this.connectivityFeatureCount=0,this._queryOpenAssociationType=async()=>{this.activeAssociationType&&await this._queryDebounced(this.activeAssociationType)},this._cancelQuery=()=>{const{_queryAbortController:i}=this;i&&i.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:i}=this;i&&i.abort(),this._queryFeatureCountAbortController=null},this._queryController=async i=>{this._cancelQuery();const s=new AbortController;this._queryAbortController=s,await xe(this._query(i)),this._queryAbortController===s&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const i=new AbortController;this._queryFeatureCountAbortController=i,await xe(this._queryFeatureCount()),this._queryFeatureCountAbortController===i&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryDebounced=ke(this._queryController,Dt),this._queryFeatureCountDebounced=ke(this._queryFeatureCountController,Dt)}initialize(){this.addHandles([L(()=>[this.graphic,this.layer,this.map,this.associationTypes,this.objectId,this.globalId,this.canQuery],()=>this.refresh(),N),L(()=>this.activeAssociationType,e=>this._queryDebounced(e),N)])}destroy(){this._cancelQuery(),this._cancelQueryFeatureCount(),this._destroyAssociatedFeatureViewModels()}get supportsCacheHint(){var e,i,s;return!!((s=(i=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:i.query)!=null&&s.supportsCacheHint)}get canLoad(){return!!this.map&&!!this.associationTypes&&typeof this.globalId=="string"}get canQuery(){var i,s;const e=(s=(i=this.layer)==null?void 0:i.capabilities)==null?void 0:s.query;return!!this.associationTypes&&typeof this.globalId=="string"&&!!(e!=null&&e.supportsPagination)}set displayCount(e){this._set("displayCount",Math.max(e??3,0))}get displayCount(){return this._get("displayCount")}get objectId(){var e,i;return(this.objectIdField&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get globalId(){var e,i;return(this.globalIdField&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[this.globalIdField]))??null}get globalIdField(){const{layer:e}=this;return e==null?void 0:e.globalIdField}get activeAssociationType(){return this._get("activeAssociationType")}set activeAssociationType(e){e&&!this.associationTypes.includes(e)||this._set("activeAssociationType",e)}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:i,_queryPageAbortController:s,canQuery:r,_loaded:n,canLoad:o,source:d}=this;return i||o&&!n?"loading":e||s?"querying":!r||d==="popup"&&this.featureCount===0?"disabled":"ready"}get utilityNetwork(){const{layer:e,map:i}=this;if(!(e!=null&&e.loaded)||!i)return null;const s=Tt(e)?e.parent:e;return Wi(i,s)}get attachmentsAssociations(){return this._get("attachmentsAssociations")||new J}get structureAssociations(){return this._get("structureAssociations")||new J}get contentAssociations(){return this._get("contentAssociations")||new J}get containerAssociations(){return this._get("containerAssociations")||new J}get connectivityAssociations(){return this._get("connectivityAssociations")||new J}get associationFeatures(){return this._get("associationFeatures")||new Mi}get associationViewModels(){return this._get("associationViewModels")||new Map}async refresh(){await this._queryFeatureCountDebounced(),await this._queryOpenAssociationType()}getFeatureCountForAssociationType(e){switch(e){case"attachment":return this.attachmentsFeatureCount;case"structure":return this.structureFeatureCount;case"content":return this.contentFeatureCount;case"container":return this.containerFeatureCount;case"connectivity":return this.connectivityFeatureCount}}_destroyAssociatedFeatureViewModels(){this.associationViewModels.forEach(e=>e.destroyAll())}async _loadUtiltyNetworks(){var s;const e=this.map;if(!e)return;await Promise.allSettled(((s=e.utilityNetworks)==null?void 0:s.map(async r=>{await r.load()}))??[]);const i=this.utilityNetwork;if(i){const r=n=>{if("layerId"in n&&i.isUtilityLayer(n)){const o=i.getSourceIdByLayerId(n.layerId);o!==null&&this.networkSourceIdsInUse.add(o)}};this._set("networkSourceIdsInUse",new Set),e.allLayers.forEach(r),e.allTables.forEach(r)}}async _findLayersBySourceId(e){const{utilityNetwork:i,map:s}=this,r=u=>{const p=u;return u.url&&p.layerId===n?u.url.replace(/\/\d+$/,"")===(i==null?void 0:i.featureServiceUrl):!1};await(i==null?void 0:i.load());const n=i.getLayerIdBySourceId(e),o=s.allLayers.filter(r),d=s.allTables.filter(r),c=o.concat(d).toArray();return await Promise.allSettled(c.map(u=>u.load())),c}_clearAssociations(){this.attachmentsAssociations.removeAll(),this.structureAssociations.removeAll(),this.contentAssociations.removeAll(),this.containerAssociations.removeAll(),this.connectivityAssociations.removeAll()}_clearFeatures(){this.associationFeatures.forEach(e=>e.removeAll()),this.associationFeatures.clear()}_getAssociationsByType(e){switch(e){case"attachment":return this.attachmentsAssociations;case"structure":return this.structureAssociations;case"connectivity":return this.connectivityAssociations;case"container":return this.containerAssociations;case"content":return this.contentAssociations}}async _queryLayer(e,i,s,r,n){const o=e.fieldsIndex.get(Pe.assetGroup),d=e.fieldsIndex.get(Pe.assetType),c=s!=null,u=r!=null,p="("+i.map(_=>`'${_}'`).join(", ")+")",m=c?` AND ${o==null?void 0:o.name} = ${s}`:"",y=c&&u?` AND ${d==null?void 0:d.name} = ${r}`:"",f=`${e.globalIdField} IN ${p}`+m+y,g=new De({outFields:["*"],cacheHint:this.supportsCacheHint,where:f});return await this._queryAll(g,e,{signal:n==null?void 0:n.signal})}async _createAssociationFeatureObjects(e,i,s,r,n,o){if(e.length===0)return[];const d=new Map;for(const[u,p]of i){const m=await this._findLayersBySourceId(u);for(const y of m)(await this._queryLayer(y,p,r,n,o)).forEach(f=>{if(this.source==="popup"?f.layer&&f.getEffectivePopupTemplate():f.layer){const g=d.get(f.attributes[y.globalIdField])??[];g.push(f),d.set(f.attributes[y.globalIdField],g)}})}const c=[];return await Promise.all(e.toArray().map(async u=>{const{fromNetworkElement:p,toNetworkElement:m}=u,y=p.globalId===s?m:p,f=d.get(y.globalId)??[];await Promise.all(f.map(async g=>{var v,b;const _=(b=(v=this.utilityNetwork)==null?void 0:v.getTerminalById(y==null?void 0:y.terminalId))==null?void 0:b.name;if(g.layer&&"getFeatureTitle"in g.layer){const w=await g.layer.getFeatureTitle(g);c.push({title:w,association:u,feature:g,terminalName:_})}else c.push({association:u,feature:g,terminalName:_})}))})),c}_parseFeatureObjects(e,i){e.forEach(s=>{const r=s==null?void 0:s.feature,n=r.layer,o=i.get(n)??new J;o.add(s),i.set(n,o)})}async _queryAll(e,i,s){var d;const r=[];let n=0,o=!1;e.num=((d=i.sourceJSON)==null?void 0:d.maxRecordCount)??2e3;do{e.start=n;const c=await i.queryFeatures(e,s);r.push(...c.features),o=c.exceededTransferLimit,o&&(n+=c.features.length)}while(o);return r}async _queryAssociations(e){const{layer:i,globalId:s,associationTypes:r,utilityNetwork:n,canQuery:o}=this;if(await Promise.allSettled([i==null?void 0:i.load(),n==null?void 0:n.load()]),this._clearAssociations(),!(o&&i&&r&&n&&s))return;const d=Tt(i)?i.parent:i,c=new Fi({globalId:s,networkSourceId:n.getSourceIdByLayerId(d.layerId)}),u=new Set;r.forEach(g=>{switch(g.type){case"attachment":case"structure":u.add("attachment");break;case"container":case"content":u.add("containment");break;case"connectivity":u.add("connectivity"),u.add("junction-junction-connectivity"),u.add("junction-edge-from-connectivity"),u.add("junction-edge-midspan-connectivity"),u.add("junction-edge-to-connectivity")}});const p=await(n==null?void 0:n.queryAssociations({elements:[c],types:Array.from(u)},{signal:e==null?void 0:e.signal})),m=new Map,y=new Map;r.forEach(g=>{y.set(g.type,g),m.set(g.type,[])}),p.forEach(g=>{var b,w,I,k,x,R;const{toNetworkElement:_,fromNetworkElement:v}=g;switch(g.associationType){case"connectivity":case"junction-junction-connectivity":case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":if((v==null?void 0:v.globalId)===s){if(this._shouldDiscardNetworkElement(_,"connectivity",y))break;(b=m.get("connectivity"))==null||b.push(_.globalId)}else{if(this._shouldDiscardNetworkElement(v,"connectivity",y))break;(w=m.get("connectivity"))==null||w.push(v.globalId)}this.connectivityAssociations.add(g);break;case"containment":if((v==null?void 0:v.globalId)===s){if(this._shouldDiscardNetworkElement(_,"content",y))break;(I=m.get("content"))==null||I.push(_.globalId),this.contentAssociations.add(g)}else{if(this._shouldDiscardNetworkElement(v,"container",y))break;(k=m.get("container"))==null||k.push(v.globalId),this.containerAssociations.add(g)}break;case"attachment":if((v==null?void 0:v.globalId)===s){if(this._shouldDiscardNetworkElement(_,"attachment",y))break;(x=m.get("attachment"))==null||x.push(_.globalId),this.attachmentsAssociations.add(g)}else{if(this._shouldDiscardNetworkElement(v,"structure",y))break;(R=m.get("structure"))==null||R.push(v.globalId),this.structureAssociations.add(g)}}});const f=r.map(async g=>{const{associatedNetworkSourceId:_,associatedAssetGroup:v,associatedAssetType:b}=g,w=m.get(g.type),I=v!=null?await this._countAssociatedFeatures(_,w,v,b,e):w.length;switch(g.type){case"attachment":this._set("attachmentsFeatureCount",I);break;case"structure":this._set("structureFeatureCount",I);break;case"content":this._set("contentFeatureCount",I);break;case"container":this._set("containerFeatureCount",I);break;case"connectivity":this._set("connectivityFeatureCount",I)}});await Promise.allSettled(f)}async _countAssociatedFeatureCount(e,i,s,r,n){const o=e.fieldsIndex.get(Pe.assetGroup),d=e.fieldsIndex.get(Pe.assetType),c=r!=null,u="("+i.map(f=>`'${f}'`).join(", ")+")",p=` AND ${o==null?void 0:o.name} = ${s}`,m=c?` AND ${d==null?void 0:d.name} = ${r}`:"",y=`${e.globalIdField} IN ${u}`+p+m;return e.queryFeatureCount({where:y,outFields:["*"],returnGeometry:!1},{signal:n==null?void 0:n.signal})}async _countAssociatedFeatures(e,i,s,r,n){if(i.length===0)return 0;const o=(await this._findLayersBySourceId(e)).map(async d=>this._countAssociatedFeatureCount(d,i,s,r,n));return(await Promise.all(o)).reduce((d,c)=>d+c,0)}async _queryAssociatedFeatures(e,i){const{layer:s,globalId:r,associationTypes:n,utilityNetwork:o,canQuery:d,associationFeatures:c}=this;if(await Promise.allSettled([s==null?void 0:s.load(),o==null?void 0:o.load()]),!(d&&s&&n&&o))return;const u=this._getAssociationsByType(e.type),{associatedAssetGroup:p,associatedAssetType:m}=e,y=new Map;u.forEach(g=>{const{fromNetworkElement:_,toNetworkElement:v}=g,{networkSourceId:b,elementGlobalId:w}=_.globalId===r?{networkSourceId:v.networkSourceId,elementGlobalId:v.globalId}:{networkSourceId:_.networkSourceId,elementGlobalId:_.globalId},I=y.get(b)||[];I.push(w),y.set(b,I)});const f=await this._createAssociationFeatureObjects(u,y,r,p,m,i);this._parseFeatureObjects(f,c)}async _queryFeatureCount(){await this._loadUtiltyNetworks();const{_queryFeatureCountAbortController:e,canQuery:i}=this;i?(await this._queryAssociations(e),this._set("featureCount",this.attachmentsFeatureCount+this.structureFeatureCount+this.contentFeatureCount+this.containerFeatureCount+this.connectivityFeatureCount)):this._set("featureCount",0)}async _query(e){if(!e)return;await this._loadUtiltyNetworks();const{_queryAbortController:i}=this;this._destroyAssociatedFeatureViewModels(),this._clearFeatures(),this.featureCount!==0&&(this.destroyed||await this._queryAssociatedFeatures(e,{signal:i==null?void 0:i.signal}))}_shouldDiscardNetworkElement(e,i,s){var c;if(!e)return!1;const{networkSourceIdsInUse:r}=this,{networkSourceId:n}=e,o=(c=s.get(i))==null?void 0:c.associatedNetworkSourceId,d=r.has(n);return o!=null&&o!==n||!d}};a([l()],C.prototype,"_loaded",void 0),a([l()],C.prototype,"_queryAbortController",void 0),a([l()],C.prototype,"_queryPageAbortController",void 0),a([l()],C.prototype,"_queryFeatureCountAbortController",void 0),a([l({readOnly:!0})],C.prototype,"supportsCacheHint",null),a([l({readOnly:!0})],C.prototype,"canLoad",null),a([l({readOnly:!0})],C.prototype,"canQuery",null),a([l()],C.prototype,"networkSourceIdsInUse",void 0),a([l({constructOnly:!0})],C.prototype,"source",void 0),a([l()],C.prototype,"description",void 0),a([l({value:3})],C.prototype,"displayCount",null),a([l({type:Ae})],C.prototype,"graphic",void 0),a([l()],C.prototype,"layer",void 0),a([l()],C.prototype,"map",void 0),a([l({readOnly:!0})],C.prototype,"objectId",null),a([l({readOnly:!0})],C.prototype,"objectIdField",null),a([l({readOnly:!0})],C.prototype,"globalId",null),a([l({readOnly:!0})],C.prototype,"globalIdField",null),a([l()],C.prototype,"featureCount",void 0),a([l()],C.prototype,"associationTypes",void 0),a([l()],C.prototype,"activeAssociationType",null),a([l()],C.prototype,"showAllEnabled",void 0),a([l()],C.prototype,"state",null),a([l()],C.prototype,"title",void 0),a([l({readOnly:!0})],C.prototype,"utilityNetwork",null),a([l({readOnly:!0})],C.prototype,"attachmentsFeatureCount",void 0),a([l({readOnly:!0})],C.prototype,"structureFeatureCount",void 0),a([l({readOnly:!0})],C.prototype,"attachmentsAssociations",null),a([l({readOnly:!0})],C.prototype,"structureAssociations",null),a([l({readOnly:!0})],C.prototype,"contentFeatureCount",void 0),a([l({readOnly:!0})],C.prototype,"containerFeatureCount",void 0),a([l({readOnly:!0})],C.prototype,"contentAssociations",null),a([l({readOnly:!0})],C.prototype,"containerAssociations",null),a([l({readOnly:!0})],C.prototype,"connectivityFeatureCount",void 0),a([l({readOnly:!0})],C.prototype,"connectivityAssociations",null),a([l({readOnly:!0})],C.prototype,"associationFeatures",null),a([l({readOnly:!0})],C.prototype,"associationViewModels",null),C=a([V("esri.widgets.support.UtilityNetworkAssociations.FeatureUtilityNetworkAssociationsViewModel")],C);const bt=C,pt="esri-feature-utility-network-associations",jt=`${pt}__loading-container`,Ve={base:pt,listContainer:`${pt}__list`,loadingContainer:jt,loadingContainerSticky:`${jt}--sticky`};let Q=class extends re{constructor(e,i){super(e,i),this._featureElementInfo=null,this.onSelectAssociationType=()=>{},this.flowType="feature-utility-network-associations",this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=5,this.viewModel=new bt,this.messages=null,this.messagesCommon=null,this.visibleElements=new yi}initialize(){this._featureElementInfo=new Re,this.addHandles([L(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),N)])}loadDependencies(){return Ie({icon:()=>F(()=>import("./index-BYYG-xAB.js").then(e=>e.av),__vite__mapDeps([0,1])),list:()=>F(()=>import("./index-BUoYXUT-.js"),__vite__mapDeps([2,0,1,3,4,5,6,7,8,9,10,11,12,13])),"list-item":()=>F(()=>import("./index-vWjR11Qv.js"),__vite__mapDeps([14,0,1,15,16,12,6,17,18,19,20,21,22,13,23])),loader:()=>F(()=>import("./index-BYYG-xAB.js").then(e=>e.au),__vite__mapDeps([0,1])),notice:()=>F(()=>import("./index-CNBosper.js"),__vite__mapDeps([24,0,1,17]))})}destroy(){this._featureElementInfo=ii(this._featureElementInfo)}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var i;const{state:e}=this.viewModel;return h("div",{class:this.classes(Ve.base,$.widget)},(i=this._featureElementInfo)==null?void 0:i.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return this.viewModel.state==="querying"?h("div",{class:Ve.loadingContainerSticky,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return h("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}_renderLoading(){return h("div",{class:Ve.loadingContainer,key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){var e;return h("calcite-notice",{icon:"exclamation-mark-triangle",key:"association-not-found",kind:"danger",open:!0,scale:"s",width:"full"},h("div",{slot:"message"},(e=this.messages)==null?void 0:e.noAssociations))}_renderAssociationType(e){const{viewModel:i}=this,s=this._getAssociationTypeTitle(e);return h("calcite-list-item",{description:Qe(e.description),key:`association-type-${e.type}`,label:Qe(s),value:e.type,onCalciteListItemSelect:()=>this.onSelectAssociationType({viewModel:i,listType:e,title:s})},h("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderAssociations(e){const{viewModel:i}=this;return i.source==="featureForm"||i.getFeatureCountForAssociationType(e.type)>0?this._renderAssociationType(e):void 0}_renderContent(){const{messages:e,viewModel:i}=this,{state:s,associationTypes:r}=i;return h("div",{class:Ve.listContainer,key:"list-container"},s==="ready"?h("div",null,h("calcite-list",{displayMode:"flat",label:e==null?void 0:e.associationsList},r.map(n=>this._renderAssociations(n)))):null,this._renderStickyLoading())}_getAssociationTypeTitle(e){const{messages:i}=this;if(e.title)return e.title;switch(e.type){case"attachment":return i.associationsAttachments;case"connectivity":return i.associationsConnectivity;case"structure":return i.associationsStructure;case"content":return i.associationsContents;case"container":return i.associationsContainer}}_setupFeatureElementInfo(){var n;const{headingLevel:e,visibleElements:i}=this,s=i.description&&this.description,r=i.title&&this.title;(n=this._featureElementInfo)==null||n.set({description:s,title:r,headingLevel:e})}};a([l({constructOnly:!0})],Q.prototype,"onSelectAssociationType",void 0),a([l()],Q.prototype,"flowType",void 0),a([l()],Q.prototype,"flowItems",void 0),a([l()],Q.prototype,"parentFeatureViewModel",void 0),a([l()],Q.prototype,"featureVisibleElements",void 0),a([l()],Q.prototype,"description",null),a([l()],Q.prototype,"headingLevel",void 0),a([l()],Q.prototype,"title",null),a([l({type:bt})],Q.prototype,"viewModel",void 0),a([l(),ee("esri/widgets/Feature/t9n/Feature")],Q.prototype,"messages",void 0),a([l(),ee("esri/t9n/common")],Q.prototype,"messagesCommon",void 0),a([l({type:yi,nonNullable:!0})],Q.prototype,"visibleElements",void 0),Q=a([V("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],Q);const ls=Q,nt=100;let M=class extends ti.ClonableMixin(mt.IdentifiableMixin(oe)){constructor(t){super(t),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.activeCategory=null,this.allCategories=null,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:e}=this;e&&e.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:e}=this;e&&e.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:e}=this;e&&e.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const e=new AbortController;this._queryAbortController=e,await xe(this._query()),this._queryAbortController===e&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const e=new AbortController;this._queryFeatureCountAbortController=e,await xe(this._queryFeatureCount()),this._queryFeatureCountAbortController===e&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const e=new AbortController;this._queryPageAbortController=e,await xe(this._queryPage()),this._queryPageAbortController===e&&(this._queryPageAbortController=null)},this._queryDebounced=ke(this._queryController,nt),this._queryFeatureCountDebounced=ke(this._queryFeatureCountController,nt),this._queryPageDebounced=ke(this._queryPageController,nt),this._query=async()=>{var s;const{_queryAbortController:e,relatedFeatures:i}=this;this.featureCount&&(((s=this.relatedLayer)==null?void 0:s.type)!=="subtype-group"||this.activeCategory)&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.destroyAll(),this.destroyed||i.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:e==null?void 0:e.signal}))))},this.addHandles([L(()=>{var e;return[this.displayCount,this.graphic,this.layer,(e=this.layer)==null?void 0:e.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory]},()=>this._queryDebounced(),N),L(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),L(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(t){const{featuresPerPage:e,featureCount:i}=this,s=1,r=Math.ceil(i/e)||1;this._set("featurePage",Math.min(Math.max(t,s),r))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:t,relatedLayer:e}=this;return t&&(e!=null&&e.loaded)?t.map(i=>{const s=i.clone();return s.field=ht(i.field,e),s}):t??[]}get supportsCacheHint(){var t,e,i;return!!((i=(e=(t=this.layer)==null?void 0:t.capabilities)==null?void 0:e.queryRelated)!=null&&i.supportsCacheHint)}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){var e,i;const t=(i=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:i.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&(t!=null&&t.supportsCount)&&(t!=null&&t.supportsPagination))}get allCategoriesCount(){var t;return((t=this.allCategories)==null?void 0:t.length)??0}get categories(){const{allCategories:t}=this;return this.showAllEnabled?t:(t==null?void 0:t.slice(0,this.displayCount))??null}set displayCount(t){this._set("displayCount",Math.min(Math.max(t??3,0),10))}get displayCount(){return this._get("displayCount")}get itemDescriptionFieldName(){var t;return((t=this.orderByFieldsFixedCasing[0])==null?void 0:t.field)||null}get objectId(){var t,e;return(this.objectIdField&&((e=(t=this.graphic)==null?void 0:t.attributes)==null?void 0:e[this.objectIdField]))??null}get objectIdField(){var t;return((t=this.layer)==null?void 0:t.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new J}get relatedLayer(){const{layer:t,map:e,relationship:i}=this;if(!(t!=null&&t.loaded)||!e||!i)return null;const s=t.type==="subtype-sublayer"&&t.parent&&di(t.parent)?t.parent:t;return Qi(e,s,i)??null}get relatedLayerKeyField(){var i,s;const{relatedLayer:t,relationshipId:e}=this;return t!=null&&t.loaded&&e!=null?(s=(i=t.relationships)==null?void 0:i.find(r=>r.id===e))==null?void 0:s.keyField:null}get relatedLayerKeyFields(){var e;const{relatedLayer:t}=this;return t!=null&&t.loaded?((e=t.relationships)==null?void 0:e.map(i=>i.keyField).filter(Le))??[]:[]}get relationship(){var i;const{relationshipId:t,layer:e}=this;return t!=null&&(e!=null&&e.loaded)?((i=e.relationships)==null?void 0:i.find(({id:s})=>s===t))??null:null}get relationshipKey(){var e,i;const{relationshipKeyField:t}=this;return(t&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[t]))??null}get relationshipKeyField(){var t;return((t=this.relationship)==null?void 0:t.keyField)||null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new J}get state(){const{_queryAbortController:t,_queryFeatureCountAbortController:e,_queryPageAbortController:i,canQuery:s,_loaded:r,canLoad:n}=this;return e||n&&!r?"loading":t||i?"querying":s?"ready":"disabled"}getRelatedFeatureByObjectId(t){return this.relatedFeatures.find(e=>e.getObjectId()===t)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){var t;(t=this.relatedFeatureViewModels)==null||t.destroyAll()}async _queryFeatureCount(){const{layer:t,relatedLayer:e}=this;await(t==null?void 0:t.load()),await(e==null?void 0:e.load());const{_queryFeatureCountAbortController:i,activeCategory:s,canQuery:r,objectId:n,relatedLayerKeyField:o,relationshipId:d,relationshipKey:c,supportsCacheHint:u}=this;if(!r||!t||!e||n==null)return this._set("featureCount",0),void this._set("allCategories",null);if((e==null?void 0:e.type)==="subtype-group"&&!s){if(this._set("featureCount",0),this._destroyRelatedFeatureViewModels(),this.featurePage=1,this.relatedFeatures.destroyAll(),o&&c!=null){const{default:g}=await F(()=>import("./uniqueValues-Cf_hQO5o.js"),__vite__mapDeps([25,26,0,1,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44])),{uniqueValueInfos:_}=await g({layer:e,sqlWhere:`${o} = '${c}'`,field:e.subtypeField,signal:i==null?void 0:i.signal}),v=_.map(({count:b,value:w})=>{var k,x;const I=(x=(k=e.subtypes)==null?void 0:k.find(R=>R.code===w))==null?void 0:x.name;return w!=null&&I?{count:b,value:w,name:I}:void 0}).filter(Le);this._set("allCategories",v)}return}const{historicMoment:p,gdbVersion:m}=t,y=new ct({cacheHint:u,gdbVersion:m,historicMoment:p,relationshipId:d,returnGeometry:!1,objectIds:[n],where:this._getRelationshipWhereClause(e)}),f=await t.queryRelatedFeaturesCount(y,{signal:i==null?void 0:i.signal});this._set("allCategories",null),this._set("featureCount",f[n]||0)}_getRelationshipWhereClause(t){const{activeCategory:e}=this,i=t.createQuery(),s="subtypeField"in t?t.subtypeField:void 0,r=e&&s?`${s} = ${e.value}`:void 0,n=i.where;return n&&r?`(${n}) AND (${r})`:n??r}_sliceFeatures(t){const{showAllEnabled:e,displayCount:i}=this;return e?t:i?t.slice(0,i):[]}async _queryPage(){var n;const{relatedFeatures:t,featurePage:e,showAllEnabled:i,_queryPageAbortController:s,featureCount:r}=this;!i||e<2||!r||((n=this.relatedLayer)==null?void 0:n.type)==="subtype-group"&&!this.activeCategory||t.addMany(await this._queryRelatedFeatures({signal:s==null?void 0:s.signal}))}async _queryRelatedFeatures(t){var le;const{displayCount:e,featureCount:i,featurePage:s,featuresPerPage:r,layer:n,orderByFieldsFixedCasing:o,relatedLayer:d,relatedLayerKeyFields:c,relationshipId:u,showAllEnabled:p,supportsCacheHint:m}=this,{canQuery:y,objectId:f}=this;if(!y||!n||!d||f==null)return[];const g=p?((s-1)*r+i)%i:0,_=p?r:e,v=d.objectIdField,b="subtypeField"in d?d.subtypeField:void 0,w=[...o.map(H=>H.field),...os(d),...c,v,b].filter(Le),I=o.map(H=>`${H.field} ${H.order}`),{historicMoment:k,gdbVersion:x}=n,R=new ct({orderByFields:I,start:g,num:_,outFields:w,cacheHint:m,historicMoment:k,gdbVersion:x,relationshipId:u,returnGeometry:!1,objectIds:[f],where:this._getRelationshipWhereClause(d)}),U=await n.queryRelatedFeatures(R,{signal:t==null?void 0:t.signal}),j=((le=U[f])==null?void 0:le.features)||[];return d.type==="subtype-group"&&b?j.forEach(H=>{var Oe;const ue=H.attributes[b],Se=(Oe=d.findSublayerForSubtypeCode)==null?void 0:Oe.call(d,ue);H.sourceLayer=Se,H.layer=Se}):j.forEach(H=>{H.sourceLayer=d,H.layer=d}),j}};a([l()],M.prototype,"_loaded",void 0),a([l()],M.prototype,"_queryAbortController",void 0),a([l()],M.prototype,"_queryPageAbortController",void 0),a([l()],M.prototype,"_queryFeatureCountAbortController",void 0),a([l({value:1})],M.prototype,"featurePage",null),a([l()],M.prototype,"featuresPerPage",void 0),a([l({readOnly:!0})],M.prototype,"orderByFieldsFixedCasing",null),a([l({readOnly:!0})],M.prototype,"supportsCacheHint",null),a([l({readOnly:!0})],M.prototype,"canLoad",null),a([l({readOnly:!0})],M.prototype,"canQuery",null),a([l()],M.prototype,"activeCategory",void 0),a([l({readOnly:!0})],M.prototype,"allCategories",void 0),a([l({readOnly:!0})],M.prototype,"allCategoriesCount",null),a([l({readOnly:!0})],M.prototype,"categories",null),a([l()],M.prototype,"description",void 0),a([l({value:3})],M.prototype,"displayCount",null),a([l({type:Ae})],M.prototype,"graphic",void 0),a([l({readOnly:!0})],M.prototype,"itemDescriptionFieldName",null),a([l()],M.prototype,"layer",void 0),a([l()],M.prototype,"map",void 0),a([l({readOnly:!0})],M.prototype,"objectId",null),a([l({readOnly:!0})],M.prototype,"objectIdField",null),a([l()],M.prototype,"orderByFields",void 0),a([l({readOnly:!0})],M.prototype,"relatedFeatures",null),a([l({readOnly:!0})],M.prototype,"relatedLayer",null),a([l({readOnly:!0})],M.prototype,"relatedLayerKeyField",null),a([l({readOnly:!0})],M.prototype,"relatedLayerKeyFields",null),a([l({readOnly:!0})],M.prototype,"relationship",null),a([l({readOnly:!0})],M.prototype,"relationshipKey",null),a([l({readOnly:!0})],M.prototype,"relationshipKeyField",null),a([l({readOnly:!0})],M.prototype,"featureCount",void 0),a([l({readOnly:!0})],M.prototype,"relatedFeatureViewModels",null),a([l()],M.prototype,"relationshipId",void 0),a([l()],M.prototype,"showAllEnabled",void 0),a([l()],M.prototype,"state",null),a([l()],M.prototype,"title",void 0),M=a([V("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],M);const wt=M;function Ze(t,e,i,s){let r=null,n=1e3;typeof e=="number"?(n=e,s=i):(r=e??null,n=i);let o,d=0;const c=()=>{d=0,t.apply(s,o)},u=(...p)=>{r&&r.apply(s,p),o=p,n?d||(d=setTimeout(c,n)):c()};return u.remove=()=>{d&&(clearTimeout(d),d=0)},u.forceUpdate=()=>{d&&(clearTimeout(d),c())},u.hasPendingUpdates=()=>!!d,u}let Ee=class extends vt{constructor(e){super(e),this.description=null,this.title=null}};a([l()],Ee.prototype,"description",void 0),a([l()],Ee.prototype,"title",void 0),Ee=a([V("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],Ee);const At=Ee,ds={base:"esri-feature-attachments"};let ie=class extends re{constructor(e,i){super(e,i),this._featureElementInfo=null,this.attachmentsWidget=new as,this.headingLevel=2,this.viewModel=new At}initialize(){this._featureElementInfo=new Re,this.addHandles([L(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),N),L(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,N)])}destroy(){var e;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var i;const{attachmentsWidget:e}=this;return h("div",{class:ds.base},(i=this._featureElementInfo)==null?void 0:i.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var r;const{description:e,title:i,headingLevel:s}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i,headingLevel:s})}};a([l({readOnly:!0})],ie.prototype,"attachmentsWidget",void 0),a([l()],ie.prototype,"description",null),a([l()],ie.prototype,"displayType",null),a([l()],ie.prototype,"graphic",null),a([l()],ie.prototype,"headingLevel",void 0),a([l()],ie.prototype,"title",null),a([l({type:At})],ie.prototype,"viewModel",void 0),ie=a([V("esri.widgets.Feature.FeatureAttachments")],ie);const cs=ie;let ce=class extends oe{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(L(()=>this.creator,i=>{this._destroyContent(),this._createContent(i)},N))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:i,destroyer:s}=this;e&&i&&(Ye({type:"content",value:s,event:{graphic:i}}),this._set("created",null))}async _createContent(e){const i=this.graphic;if(!i||!e)return;const s=Ye({type:"content",value:e,event:{graphic:i}});this._loadingPromise=s,this.notifyChange("state");const r=await s;s===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};a([l({readOnly:!0})],ce.prototype,"created",void 0),a([l()],ce.prototype,"creator",void 0),a([l()],ce.prototype,"destroyer",void 0),a([l({type:Ae})],ce.prototype,"graphic",void 0),a([l({readOnly:!0})],ce.prototype,"state",null),ce=a([V("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],ce);const Ge=ce,at="esri-feature-content",ot={base:at,loaderContainer:`${at}__loader-container`,loader:`${at}__loader`};let _e=class extends re{constructor(e,i){super(e,i),this.viewModel=null,this._addTargetToAnchors=s=>{Array.from(s.querySelectorAll("a")).forEach(r=>{ci(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){var i;const e=(i=this.viewModel)==null?void 0:i.state;return h("div",{class:ot.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return h("div",{class:ot.loaderContainer,key:"loader"},h("div",{class:ot.loader}))}_renderCreated(){var i;const e=(i=this.viewModel)==null?void 0:i.created;return e?e instanceof HTMLElement?h("div",{afterCreate:this._attachToNode,bind:e,key:e}):pi(e)?h("div",{key:e},!e.destroyed&&e.render()):h("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){const i=this;e.appendChild(i)}};a([l()],_e.prototype,"creator",null),a([l()],_e.prototype,"graphic",null),a([l({type:Ge})],_e.prototype,"viewModel",void 0),_e=a([V("esri.widgets.Feature.FeatureContent")],_e);const je=_e;let ae=class extends oe{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:i}=this,s=[];return i==null||i.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const n=r.clone();n.label=ui(n,e),s.push(n)}),s}};a([l()],ae.prototype,"attributes",void 0),a([l({type:[$i]})],ae.prototype,"expressionInfos",void 0),a([l()],ae.prototype,"description",void 0),a([l({type:[si]})],ae.prototype,"fieldInfos",void 0),a([l({readOnly:!0})],ae.prototype,"formattedFieldInfos",null),a([l()],ae.prototype,"title",void 0),ae=a([V("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],ae);const Je=ae,us=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function hs(t,e){if(typeof e!="string"||!e)return e;const i=us.find(c=>c.pattern.test(e));if(!i)return e;const s=e.match(i.pattern),r=s==null?void 0:s[2],n=Et(Et(i.label,{messages:t,hierPart:r}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",d=i.target==="_blank"?' rel="noreferrer"':"";return e.replace(i.pattern,`<a${o} href="$1"${d}>${n}</a>`)}const qe="esri-feature-fields",Ne={base:qe,fieldHeader:`${qe}__field-header`,fieldData:`${qe}__field-data`,fieldDataDate:`${qe}__field-data--date`};let G=class extends re{constructor(e,i){super(e,i),this._featureElementInfo=null,this.viewModel=new Je,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Re,this.addHandles(L(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),N))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return h("div",{class:Ne.base},(e=this._featureElementInfo)==null?void 0:e.render(),this._renderFields())}_renderFieldInfo(e,i){var p;const{attributes:s}=this.viewModel,r=e.fieldName||"",n=e.label||r,o=s?s[r]==null?"":s[r]:"",d=!!((p=e.format)!=null&&p.dateFormat),c=typeof o=="number"&&!d?this._forceLTR(o):hs(this.messagesURIUtils,o),u={[Ne.fieldDataDate]:d};return h("tr",{key:`fields-element-info-row-${r}-${i}`},h("th",{class:Ne.fieldHeader,innerHTML:n,key:`fields-element-info-row-header-${r}-${i}`}),h("td",{class:this.classes(Ne.fieldData,u),innerHTML:c,key:`fields-element-info-row-data-${r}-${i}`}))}_renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?h("table",{class:$.table,summary:this.messages.fieldsSummary},h("tbody",null,e.map((i,s)=>this._renderFieldInfo(i,s)))):null}_setupFeatureElementInfo(){var s;const{description:e,title:i}=this;(s=this._featureElementInfo)==null||s.set({description:e,title:i})}_forceLTR(e){return`&lrm;${e}`}};a([l()],G.prototype,"attributes",null),a([l()],G.prototype,"description",null),a([l()],G.prototype,"expressionInfos",null),a([l()],G.prototype,"fieldInfos",null),a([l()],G.prototype,"title",null),a([l({type:Je,nonNullable:!0})],G.prototype,"viewModel",void 0),a([l(),ee("esri/widgets/Feature/t9n/Feature")],G.prototype,"messages",void 0),a([l(),ee("esri/widgets/support/t9n/uriUtils")],G.prototype,"messagesURIUtils",void 0),G=a([V("esri.widgets.Feature.FeatureFields")],G);const fi=G,ps={maximumFractionDigits:20};function ms(t){return ut(t,ps)}const ys="<",fs=">";function gs(t,e,i,s){let r="";return e===0?r=`${ys} `:e===i&&(r=`${fs} `),r+ms(t)}const _s=new ri([64,64,64]);function vs(t,e){const i=[],s=t.length-1;return t.length===5?i.push(0,2,4):i.push(0,s),t.map((r,n)=>i.includes(n)?gs(r,n,s):null)}async function bs(t,e,i){let s=!1,r=[],n=[];if(t.stops){const u=t.stops;r=u.map(p=>p.value),s=u.some(p=>!!p.label),s&&(n=u.map(p=>p.label))}const o=r[0],d=r[r.length-1];if(o==null&&d==null)return null;const c=s?null:vs(r);return(await Promise.all(r.map(async(u,p)=>({value:u,color:t.type==="opacity"?await ws(u,t):(await F(async()=>{const{getColor:m}=await import("./CodeBlock-DBIw63CI.js").then(y=>y.uo);return{getColor:m}},__vite__mapDeps([26,0,1,27]))).getColor(t,u),label:s?n[p]:(c==null?void 0:c[p])??""})))).reverse()}async function ws(t,e,i){const s=new ri(_s),r=(await F(async()=>{const{getOpacity:n}=await import("./CodeBlock-DBIw63CI.js").then(o=>o.uo);return{getOpacity:n}},__vite__mapDeps([26,0,1,27]))).getOpacity(e,t);return r!=null&&(s.a=r),s}function As(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(s=>{var r;return((r=s.color)==null?void 0:r.a)>0});let i=e.length-1;if(e[0]){const s=e[i];s&&s.ratio!==1&&(e.push(new Ti({ratio:1,color:s.color})),i++)}return e.map((s,r)=>{var o,d;let n="";return r===0?n=((o=t.legendOptions)==null?void 0:o.minLabel)||"low":r===i&&(n=((d=t.legendOptions)==null?void 0:d.maxLabel)||"high"),{color:s.color,label:n,ratio:s.ratio}}).reverse()}async function Z(t,e,i){Ei(t,e,()=>[]).push(...i)}async function Is(t){var i,s;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){for(const r of t.visualVariables)if(Cs(r)){const n=(await bs(r)??[]).map(o=>o.color);await Z(e,r.field||r.valueExpression,n)}}if(t.type==="heatmap"){const r=As(t).map(n=>n.color);await Z(e,t.field||t.valueExpression,r)}else if(t.type==="pie-chart"){for(const r of t.attributes)await Z(e,r.field||r.valueExpression,[r.color]);await Z(e,"default",[(i=t==null?void 0:t.othersCategory)==null?void 0:i.color,fe(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const r of t.attributes)await Z(e,r.field||r.valueExpression,[r.color]);await Z(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((s=t.authoringInfo)==null?void 0:s.type)==="predominance")for(const r of t.uniqueValueInfos??[])await Z(e,r.value.toString(),[fe(r.symbol,null)]);else{const r=(t.uniqueValueInfos??[]).map(u=>fe(u.symbol,null)),{field:n,field2:o,field3:d,valueExpression:c}=t;(n||c)&&await Z(e,n||c,r),o&&await Z(e,o,r),d&&await Z(e,d,r)}else if(t.type==="class-breaks"){const r=t.classBreakInfos.map(d=>fe(d.symbol,null)),{field:n,valueExpression:o}=t;await Z(e,n??o,r)}else t.type==="simple"&&await Z(e,"default",[fe(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await Z(e,"default",[fe(t.defaultSymbol,null)]),e.forEach((r,n)=>{const o=yt(r.filter(Boolean),(d,c)=>JSON.stringify(d)===JSON.stringify(c));e.set(n,o)}),e}function Cs(t){return t.type==="color"}const Ms="esri.widgets.Feature.support.relatedFeatureUtils",Bt=()=>Xe.getLogger(Ms),Ut=new Map;function Be(t){if(!pe(t))return null;const[e,i]=t.split("/").slice(1);return{layerId:e,fieldName:i}}function Fs(t,e){if(!e.relationships)return null;let i=null;const{relationships:s}=e;return s.some(r=>r.id===parseInt(t,10)&&(i=r,!0)),i}function $s({originRelationship:t,relationships:e,layerId:i}){return e.find(({relatedTableId:s,id:r})=>`${s}`===i&&r===(t==null?void 0:t.id))??null}function Ts(t,e){const i=e.toLowerCase();for(const s in t)if(s.toLowerCase()===i)return t[s];return null}function Es(t,e){const i=Fs(t,e);if(i)return{url:`${e.url}/${i.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function xs(t,e){if(!e||!t)return;const{features:i,statsFeatures:s}=t,r=i==null?void 0:i.value;e.relatedFeatures=r?r.features:[];const n=s==null?void 0:s.value;e.relatedStatsFeatures=n?n.features:[]}function ks(t,e,i,s){var n;const r=new ct;return r.outFields=["*"],r.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),r.objectIds=[t.attributes[i.objectIdField]],r.gdbVersion=i.gdbVersion??null,r.historicMoment=i.historicMoment??null,((n=i.queryRelatedFeatures)==null?void 0:n.call(i,r,s))??Promise.resolve({})}function Ls(t,e,i){let s=0;const r=[];for(;s<e.length;)r.push(`${t} IN (${e.slice(s,i+s)})`),s+=i;return r.join(" OR ")}function Rs(t){return t?yt(t):void 0}function Ss(t){return t?yt(t,(e,i)=>JSON.stringify(e.toJSON())===JSON.stringify(i.toJSON())):void 0}async function Os(t,e,i,s){const r=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:d,outStatistics:c,url:u,sourceSpatialReference:p}=e,m=Rs(d),y=Ss(c);if(!n||!o)return null;const f=$s({originRelationship:o,relationships:n.relationships,layerId:r});if(f!=null&&f.relationshipTableId&&f.keyFieldInRelationshipTable){const _=(await ks(t,f,i,s))[t.attributes[i.objectIdField]];if(!_)return null;const v=_.features.map(b=>b.attributes[n.objectIdField]);if(y!=null&&y.length&&n.supportsStatistics){const b=new De;b.where=Ls(n.objectIdField,v,1e3),b.outFields=m,b.outStatistics=y,b.sourceSpatialReference=p;const w={features:Promise.resolve(_),statsFeatures:tt(u,b)};return be(w)}}const g=f==null?void 0:f.keyField;if(g){const _=Ri(Ds(n.fields,g)),v=Ts(t.attributes,o.keyField),b=_?`${g}=${v}`:`${g}='${v}'`,w=i.historicMoment,I=i.gdbVersion,k=tt(u,new De({where:b,outFields:m,sourceSpatialReference:p,historicMoment:w,gdbVersion:I}),s),x=y!=null&&y.length&&n.supportsStatistics?tt(u,new De({where:b,outFields:m,outStatistics:y,sourceSpatialReference:p}),s):null,R={features:k};return x&&(R.statsFeatures=x),be(R)}return null}function Ps(t,e){return Li(t,{query:{f:"json"},signal:e==null?void 0:e.signal})}function Vs({relatedInfos:t,layer:e},i){const s={};return t.forEach((r,n)=>{const{relation:o}=r;if(!o){const m=new P("relation-required","A relation is required on a layer to retrieve related records.");throw Bt().error(m),m}const{relatedTableId:d}=o;if(typeof d!="number"){const m=new P("A related table ID is required on a layer to retrieve related records.");throw Bt().error(m),m}const c=`${e.url}/${d}`,u=Ut.get(c),p=u??Ps(c);u||Ut.set(c,p),s[n]=p}),xi(be(s),i)}function qs({graphic:t,relatedInfos:e,layer:i},s){const r={};return e.forEach((n,o)=>{n.layerInfo&&(r[o]=Os(t,n,i,s))}),be(r)}function Ns({relatedInfo:t,fieldName:e,fieldInfo:i}){var s,r;if((s=t.relatedFields)==null||s.push(e),i.statisticType){const n=new ki({statisticType:i.statisticType,onStatisticField:e,outStatisticFieldName:e});(r=t.outStatistics)==null||r.push(n)}}function Ds(t,e){if(t!=null){e=e.toLowerCase();for(const i of t)if(i&&i.name.toLowerCase()===e)return i}return null}const Ht={chartAnimation:!0};let q=class extends oe{constructor(e){super(e),this.abilities={...Ht},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Ht,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:i}=this,s=(e+i)%i;this.activeMediaInfoIndex=s}_pageContentElementMedia(e){const{activeMediaInfoIndex:i}=this,s=i+e;this._setContentElementMedia(s)}_formatMediaInfos(){const{mediaInfos:e,layer:i}=this,s=this.attributes??{},r=this.formattedAttributes??{},n=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(d=>{const c=d==null?void 0:d.clone();return c?(c.title=me({attributes:s,fieldInfoMap:o,globalAttributes:r,expressionAttributes:n,layer:i,text:c.title}),c.caption=me({attributes:s,fieldInfoMap:o,globalAttributes:r,expressionAttributes:n,layer:i,text:c.caption}),c.altText=me({attributes:s,fieldInfoMap:o,globalAttributes:r,expressionAttributes:n,layer:i,text:c.altText}),c.type==="image"?c.value?(this._setImageValue({value:c.value,formattedAttributes:r,layer:i}),c.value.sourceURL?c:void 0):void 0:c.type==="pie-chart"||c.type==="line-chart"||c.type==="column-chart"||c.type==="bar-chart"?c.value?(this._setChartValue({value:c.value,chartType:c.type,attributes:s,formattedAttributes:r,layer:i,expressionAttributes:n}),c):void 0:null):null}).filter(Le))??[]}_setImageValue(e){const i=this.fieldInfoMap??new Map,{value:s,formattedAttributes:r,layer:n}=e,{linkURL:o,sourceURL:d}=s;if(d){const c=Lt(d,n);s.sourceURL=Rt({formattedAttributes:r,template:c,fieldInfoMap:i})}if(o){const c=Lt(o,n);s.linkURL=Rt({formattedAttributes:r,template:c,fieldInfoMap:i})}}_setChartValue(e){const{value:i,attributes:s,formattedAttributes:r,chartType:n,layer:o,expressionAttributes:d}=e,{popupTemplate:c,relatedInfos:u}=this,{fields:p,normalizeField:m}=i,y=o;if(i.fields=Xi(p,y),m&&(i.normalizeField=ht(m,y)),!p.some(g=>!!(r[g]!=null||pe(g)&&(u!=null&&u.size))))return;const f=(c==null?void 0:c.fieldInfos)??[];p.forEach((g,_)=>{var w;const v=(w=i.colors)==null?void 0:w[_];if(pe(g))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:f,fieldName:g,formattedAttributes:r,chartType:n,value:i,color:v})]);const b=this._getChartOption({value:i,attributes:s,chartType:n,formattedAttributes:r,expressionAttributes:d,fieldName:g,fieldInfos:f,color:v});i.series.push(b)})}_getRelatedChartInfos(e){var g;const{fieldInfos:i,fieldName:s,formattedAttributes:r,chartType:n,value:o,color:d}=e,c=[],u=Be(s),p=u&&((g=this.relatedInfos)==null?void 0:g.get(u.layerId.toString()));if(!p)return c;const{relatedFeatures:m,relation:y}=p;if(!y||!m)return c;const{cardinality:f}=y;return m.forEach(_=>{const{attributes:v}=_;v&&Object.keys(v).forEach(b=>{b===u.fieldName&&c.push(this._getChartOption({value:o,attributes:v,formattedAttributes:r,fieldName:s,chartType:n,relatedFieldName:b,hasMultipleRelatedFeatures:(m==null?void 0:m.length)>1,fieldInfos:i,color:d}))})}),f==="one-to-many"||f==="many-to-many"?c:[c[0]]}_getTooltip({label:e,value:i,chartType:s}){return s==="pie-chart"?`${e}`:`${e}: ${i}`}_getChartOption(e){var U;const{value:i,attributes:s,formattedAttributes:r,expressionAttributes:n,fieldName:o,relatedFieldName:d,fieldInfos:c,chartType:u,hasMultipleRelatedFeatures:p,color:m}=e,y=this.layer,f=this.fieldInfoMap??new Map,{normalizeField:g,tooltipField:_}=i,v=g?pe(g)?s[Be(g).fieldName]:s[g]:null,b=hi(o)&&n&&n[o]!==void 0?n[o]:d&&s[d]!==void 0?s[d]:s[o]!==void 0?s[o]:r[o],w=new Si({fieldName:o,color:m,value:b===void 0?null:b&&v?b/v:b});if(pe(o)){const j=f.get(o.toLowerCase()),le=_&&f.get(_.toLowerCase()),H=(j==null?void 0:j.fieldName)??o,ue=p&&_?Be(_).fieldName:(le==null?void 0:le.fieldName)??_,Se=p&&ue?s[ue]:r[ue]??(j==null?void 0:j.label)??(j==null?void 0:j.fieldName)??d,Oe=p&&d?s[d]:r[H];return w.tooltip=this._getTooltip({label:Se,value:Oe,chartType:u}),w}const I=Ki(c,o),k=ht(o,y),x=_&&r[_]!==void 0?r[_]:ui(I||new si({fieldName:k}),(U=this.popupTemplate)==null?void 0:U.expressionInfos),R=r[k];return w.tooltip=this._getTooltip({label:x,value:R,chartType:u}),w}};a([l()],q.prototype,"abilities",void 0),a([we("abilities")],q.prototype,"castAbilities",null),a([l()],q.prototype,"activeMediaInfoIndex",void 0),a([l({readOnly:!0})],q.prototype,"activeMediaInfo",null),a([l()],q.prototype,"attributes",void 0),a([l()],q.prototype,"description",void 0),a([l()],q.prototype,"fieldInfoMap",void 0),a([l()],q.prototype,"formattedAttributes",void 0),a([l()],q.prototype,"expressionAttributes",void 0),a([l({readOnly:!0})],q.prototype,"formattedMediaInfos",null),a([l()],q.prototype,"isAggregate",void 0),a([l()],q.prototype,"layer",void 0),a([l({readOnly:!0})],q.prototype,"formattedMediaInfoCount",null),a([l()],q.prototype,"mediaInfos",void 0),a([l()],q.prototype,"popupTemplate",void 0),a([l()],q.prototype,"relatedInfos",void 0),a([l()],q.prototype,"title",void 0),q=a([V("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],q);const ye=q,Y="esri-feature-media",z={base:Y,mediaContainer:`${Y}__container`,mediaItemContainer:`${Y}__item-container`,mediaItem:`${Y}__item`,mediaItemText:`${Y}__item-text`,mediaItemTitle:`${Y}__item-title`,mediaItemCaption:`${Y}__item-caption`,mediaNavigation:`${Y}__item-navigation`,mediaPagination:`${Y}__pagination`,mediaPaginationText:`${Y}__pagination-text`,mediaChart:`${Y}__chart`,mediaPaginationButton:`${Y}__pagination-button`,mediaPaginationIcon:`${Y}__pagination-icon`,mediaChartRendered:`${Y}__chart--rendered`},lt=15,de="category",Me="value",js="rgba(50, 50, 50, 1)",Bs=250,Us=500,Hs=200;let X=class extends re{constructor(t,e){super(t,e),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new ye,this.messages=null,this._disposeChart=i=>{var s;(s=this._chartRootMap.get(i))==null||s.dispose(),this._chartRootMap.delete(i)},this._createChart=async i=>{const{destroyed:s,viewModel:r}=this;if(s||!r||!i)return;const{createRoot:n}=await F(()=>import("./chartUtilsAm5-DbmtZU2A.js"),__vite__mapDeps([45,26,0,1,27,46,47,48])),o=await n(i);this._chartRootMap.set(i,o),this._renderChart({mediaInfo:r.activeMediaInfo,root:o})}}initialize(){this._featureElementInfo=new Re,this.addHandles([L(()=>{var t,e;return[(t=this.viewModel)==null?void 0:t.activeMediaInfo,(e=this.viewModel)==null?void 0:e.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),N),L(()=>{var t,e;return[(t=this.viewModel)==null?void 0:t.description,(e=this.viewModel)==null?void 0:e.title]},()=>this._setupFeatureElementInfo(),N)])}loadDependencies(){return Ie({icon:()=>F(()=>import("./index-BYYG-xAB.js").then(t=>t.av),__vite__mapDeps([0,1]))})}destroy(){var t;this._clearMediaRefreshTimer(),(t=this._featureElementInfo)==null||t.destroy()}get attributes(){return this.viewModel.attributes}set attributes(t){this.viewModel.attributes=t}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(t){this.viewModel.activeMediaInfoIndex=t}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(t){this.viewModel.fieldInfoMap=t}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(t){this.viewModel.mediaInfos=t}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(t){this.viewModel.popupTemplate=t}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(t){this.viewModel.relatedInfos=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){var t;return h("div",{bind:this,class:z.base,onkeyup:this._handleMediaKeyup},(t=this._featureElementInfo)==null?void 0:t.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:t,activeMediaInfoIndex:e}=this.viewModel,i=this._renderMediaText();return t?h("div",{class:z.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),h("div",{class:z.mediaNavigation},i,t>1?h("div",{class:z.mediaPagination},this._renderMediaPageButton("previous"),h("span",{class:z.mediaPaginationText},_t(this.messages.pageText,{index:e+1,total:t})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:t}=this.viewModel;if(!t)return null;const e=t&&t.title?h("div",{class:z.mediaItemTitle,innerHTML:t.title,key:"media-title"}):null,i=t&&t.caption?h("div",{class:z.mediaItemCaption,innerHTML:t.caption,key:"media-caption"}):null;return e||i?h("div",{class:z.mediaItemText,key:"media-text"},e,i):null}_renderImageMediaInfo(t){if(!t.value)return null;const{_refreshIntervalInfo:e}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:r,refreshInterval:n,altText:o,title:d,type:c}=t,{sourceURL:u,linkURL:p}=r,m=ci(p??void 0)?"_blank":"_self",y=m==="_blank"?"noreferrer":"",f=n?e:null,g=f?f.timestamp:0,_=f?f.sourceURL:u,v=h("img",{alt:o||d,key:`media-${c}-${i}-${s}-${g}`,src:_??void 0});return(p?h("a",{href:p,rel:y,target:m,title:d},v):null)??v}_renderChartMediaInfo(t){const{activeMediaInfoIndex:e,formattedMediaInfoCount:i}=this.viewModel;return h("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:z.mediaChart,key:`media-${t.type}-${e}-${i}`})}_renderMediaInfoType(){const{activeMediaInfo:t}=this.viewModel;return t?t.type==="image"?this._renderImageMediaInfo(t):t.type.includes("chart")?this._renderChartMediaInfo(t):null:null}_renderMediaInfo(){const{activeMediaInfo:t}=this.viewModel;return t?h("div",{class:z.mediaItemContainer,key:"media-container"},h("div",{class:z.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(t){if(this.viewModel.formattedMediaInfoCount<2)return null;const e=t==="previous",i=e?this.messages.previous:this.messages.next,s=e?"chevron-left":"chevron-right",r=e?"media-previous":"media-next",n=e?this._previous:this._next;return h("button",{"aria-label":i,bind:this,class:z.mediaPaginationButton,key:r,onclick:n,tabIndex:0,title:i,type:"button"},h("calcite-icon",{class:z.mediaPaginationIcon,icon:s,scale:"s"}))}_setupFeatureElementInfo(){var i;const{description:t,title:e}=this;(i=this._featureElementInfo)==null||i.set({description:t,title:e})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:t,layer:e}=this.viewModel;return t&&(e!=null&&e.featureReduction)&&"renderer"in e.featureReduction?e.featureReduction.renderer:e==null?void 0:e.renderer}async _getSeriesColors(t){const{colorAm5:e}=await F(()=>import("./chartCommon-BLhzEe9n.js"),__vite__mapDeps([49,46,26,0,1,27,50,47,51])),i=new Map;return t.forEach(s=>{s.color&&i.set(s,e(s.color.toCss(!0)))}),i}async _getRendererColors(){const{colorAm5:t}=await F(()=>import("./chartCommon-BLhzEe9n.js"),__vite__mapDeps([49,46,26,0,1,27,50,47,51])),e=new Map,i=this._getRenderer(),s="default";if(!i)return e;const r=await Is(i);return r.delete(s),Array.from(r.values()).every(n=>(n==null?void 0:n.length)===1)&&Array.from(r.keys()).forEach(n=>{var d,c;const o=(c=(d=r.get(n))==null?void 0:d[0])==null?void 0:c.toCss(!0);o&&e.set(n,t(o))}),e}_handleMediaKeyup(t){const{key:e}=t;e==="ArrowLeft"&&(t.stopPropagation(),this.viewModel.previous()),e==="ArrowRight"&&(t.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!Oi()}_getChartAnimationMS(){return this._canAnimateChart()?Bs:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Us:0}async _renderChart(t){const{root:e,mediaInfo:i}=t,{value:s,type:r}=i,{ResponsiveThemeAm5:n,DarkThemeAm5:o,AnimatedThemeAm5:d,ColorSetAm5:c,ThemeAm5:u,esriChartColorSet:p}=await F(async()=>{const{ResponsiveThemeAm5:I,DarkThemeAm5:k,AnimatedThemeAm5:x,ColorSetAm5:R,ThemeAm5:U,esriChartColorSet:j}=await import("./chartCommon-BLhzEe9n.js");return{ResponsiveThemeAm5:I,DarkThemeAm5:k,AnimatedThemeAm5:x,ColorSetAm5:R,ThemeAm5:U,esriChartColorSet:j}},__vite__mapDeps([49,46,26,0,1,27,50,47,51])),m=u.new(e);m.rule("ColorSet").set("colors",p),m.rule("ColorSet").set("reuse",!0);const y=[n.new(e),m];Pi()&&y.push(o.new(e)),this._canAnimateChart()&&y.push(d.new(e)),e.setThemes(y);const f=await this._getRendererColors(),g=await this._getSeriesColors(s.series),_=c.new(e,{}),v=g.get(s.series[0]),b=v?{lineSettings:{stroke:v}}:void 0,w=s.series.map((I,k)=>{const x=g.get(I)||f.get(I.fieldName)||_.getIndex(k);return{[de]:I.tooltip,[Me]:I.value,columnSettings:{fill:x,stroke:x},...b}}).filter(I=>r!=="pie-chart"||I.value!=null&&I.value>0);r==="pie-chart"?this._createPieChart(t,w):this._createXYChart(t,w)}_getDirection(){return he(this.container)?"rtl":"ltr"}async _customizeChartTooltip(t,e="horizontal"){var s;const{colorAm5:i}=await F(()=>import("./chartCommon-BLhzEe9n.js"),__vite__mapDeps([49,46,26,0,1,27,50,47,51]));t.setAll({pointerOrientation:e}),(s=t.get("background"))==null||s.setAll({stroke:i(js)}),t.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:Hs})}async _createPieChart(t,e){const{TooltipAm5:i}=await F(()=>import("./chartCommon-BLhzEe9n.js"),__vite__mapDeps([49,46,26,0,1,27,50,47,51])),{PieChartAm5:s,PieSeriesAm5:r}=await F(async()=>{const{PieChartAm5:g,PieSeriesAm5:_}=await import("./pieChart-CA47eCrq.js");return{PieChartAm5:g,PieSeriesAm5:_}},__vite__mapDeps([52,26,0,1,27,53,46,51,48])),{mediaInfo:n,root:o}=t,{title:d}=n,c=5,u=(n==null?void 0:n.altText)||(n==null?void 0:n.title)||"",p=o.container.children.push(s.new(o,{ariaLabel:u,focusable:!0,paddingBottom:c,paddingTop:c,paddingLeft:c,paddingRight:c})),m=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,y=i.new(o,{labelText:m}),f=p.series.push(r.new(o,{name:d,valueField:Me,categoryField:de,tooltip:y}));f.ticks.template.set("forceHidden",!0),f.labels.template.set("forceHidden",!0),f.slices.template.states.create("active",{shiftRadius:c}),this._customizeChartTooltip(y),f.slices.template.setAll({ariaLabel:m,focusable:!0,templateField:"columnSettings"}),f.data.setAll(e),f.appear(this._getChartSeriesAnimationMS()),p.appear(this._getChartAnimationMS()),p.root.dom.classList.toggle(z.mediaChartRendered,!0)}_getMinSeriesValue(t){let e=0;return t.forEach(i=>e=Math.min(i.value,e)),e}async _createColumnChart(t,e,i){const{TooltipAm5:s,ScrollbarAm5:r}=await F(()=>import("./chartCommon-BLhzEe9n.js"),__vite__mapDeps([49,46,26,0,1,27,50,47,51])),{CategoryAxisAm5:n,AxisRendererXAm5:o,ValueAxisAm5:d,AxisRendererYAm5:c,ColumnSeriesAm5:u}=await F(async()=>{const{CategoryAxisAm5:I,AxisRendererXAm5:k,ValueAxisAm5:x,AxisRendererYAm5:R,ColumnSeriesAm5:U}=await import("./xyChart-Wg9Vaye3.js");return{CategoryAxisAm5:I,AxisRendererXAm5:k,ValueAxisAm5:x,AxisRendererYAm5:R,ColumnSeriesAm5:U}},__vite__mapDeps([54,46,26,0,1,27,51,48,53,50])),{mediaInfo:p,root:m}=e,{value:y,title:f}=p;t.setAll({wheelX:"panX",wheelY:"zoomX"});const g=t.xAxes.push(n.new(m,{renderer:o.new(m,{inversed:he(this.container)}),categoryField:de}));g.get("renderer").labels.template.setAll({forceHidden:!0});const _=t.yAxes.push(d.new(m,{renderer:c.new(m,{inside:!1}),min:this._getMinSeriesValue(y.series)}));_.get("renderer").labels.template.setAll({direction:this._getDirection()});const v="{categoryX}",b=s.new(m,{labelText:v}),w=t.series.push(u.new(m,{name:f,xAxis:g,yAxis:_,valueYField:Me,categoryXField:de,tooltip:b}));this._customizeChartTooltip(b),w.columns.template.setAll({ariaLabel:v,focusable:!0,templateField:"columnSettings"}),y.series.length>lt&&t.set("scrollbarX",r.new(m,{orientation:"horizontal"})),g.data.setAll(i),w.data.setAll(i),w.appear(this._getChartSeriesAnimationMS()),t.appear(this._getChartAnimationMS())}async _createBarChart(t,e,i){const{TooltipAm5:s,ScrollbarAm5:r}=await F(()=>import("./chartCommon-BLhzEe9n.js"),__vite__mapDeps([49,46,26,0,1,27,50,47,51])),{CategoryAxisAm5:n,AxisRendererXAm5:o,ValueAxisAm5:d,AxisRendererYAm5:c,ColumnSeriesAm5:u}=await F(async()=>{const{CategoryAxisAm5:I,AxisRendererXAm5:k,ValueAxisAm5:x,AxisRendererYAm5:R,ColumnSeriesAm5:U}=await import("./xyChart-Wg9Vaye3.js");return{CategoryAxisAm5:I,AxisRendererXAm5:k,ValueAxisAm5:x,AxisRendererYAm5:R,ColumnSeriesAm5:U}},__vite__mapDeps([54,46,26,0,1,27,51,48,53,50])),{mediaInfo:p,root:m}=e,{value:y,title:f}=p;t.setAll({wheelX:"panY",wheelY:"zoomY"});const g=t.yAxes.push(n.new(m,{renderer:c.new(m,{inversed:!0}),categoryField:de}));g.get("renderer").labels.template.setAll({forceHidden:!0});const _=t.xAxes.push(d.new(m,{renderer:o.new(m,{inside:!1,inversed:he(this.container)}),min:this._getMinSeriesValue(y.series)}));_.get("renderer").labels.template.setAll({direction:this._getDirection()});const v="{categoryY}",b=s.new(m,{labelText:v}),w=t.series.push(u.new(m,{name:f,xAxis:_,yAxis:g,valueXField:Me,categoryYField:de,tooltip:b}));this._customizeChartTooltip(b,"vertical"),w.columns.template.setAll({ariaLabel:v,focusable:!0,templateField:"columnSettings"}),y.series.length>lt&&t.set("scrollbarY",r.new(m,{orientation:"vertical"})),g.data.setAll(i),w.data.setAll(i),w.appear(this._getChartSeriesAnimationMS()),t.appear(this._getChartAnimationMS())}async _createLineChart(t,e,i){var k,x,R;const{TooltipAm5:s,ScrollbarAm5:r}=await F(()=>import("./chartCommon-BLhzEe9n.js"),__vite__mapDeps([49,46,26,0,1,27,50,47,51])),{CategoryAxisAm5:n,AxisRendererXAm5:o,ValueAxisAm5:d,AxisRendererYAm5:c,LineSeriesAm5:u}=await F(async()=>{const{CategoryAxisAm5:U,AxisRendererXAm5:j,ValueAxisAm5:le,AxisRendererYAm5:H,LineSeriesAm5:ue}=await import("./xyChart-Wg9Vaye3.js");return{CategoryAxisAm5:U,AxisRendererXAm5:j,ValueAxisAm5:le,AxisRendererYAm5:H,LineSeriesAm5:ue}},__vite__mapDeps([54,46,26,0,1,27,51,48,53,50])),{root:p,mediaInfo:m}=e,{value:y,title:f}=m;t.setAll({wheelX:"panX",wheelY:"zoomX"});const g=t.xAxes.push(n.new(p,{renderer:o.new(p,{inversed:he(this.container)}),categoryField:de}));g.get("renderer").labels.template.setAll({forceHidden:!0});const _=t.yAxes.push(d.new(p,{renderer:c.new(p,{inside:!1}),min:this._getMinSeriesValue(y.series)}));_.get("renderer").labels.template.setAll({direction:this._getDirection()});const v="{categoryX}",b=(x=(k=i[0])==null?void 0:k.lineSettings)==null?void 0:x.stroke,w=s.new(p,{getFillFromSprite:!b,labelText:v});b&&((R=w.get("background"))==null||R.setAll({fill:b}));const I=t.series.push(u.new(p,{name:f,xAxis:g,yAxis:_,valueYField:Me,categoryXField:de,tooltip:w}));I.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(w,"vertical"),y.series.length>lt&&t.set("scrollbarX",r.new(p,{orientation:"horizontal"})),g.data.setAll(i),I.data.setAll(i),I.appear(this._getChartSeriesAnimationMS()),t.appear(this._getChartAnimationMS())}async _createXYChart(t,e){const{XYChartAm5:i,XYCursorAm5:s}=await F(()=>import("./xyChart-Wg9Vaye3.js"),__vite__mapDeps([54,46,26,0,1,27,51,48,53,50])),{root:r,mediaInfo:n}=t,{type:o}=n,d=(n==null?void 0:n.altText)||(n==null?void 0:n.title)||"",c=r.container.children.push(i.new(r,{ariaLabel:d,focusable:!0,panX:!0,panY:!0}));c.set("cursor",s.new(r,{})),o==="column-chart"&&await this._createColumnChart(c,t,e),o==="bar-chart"&&await this._createBarChart(c,t,e),o==="line-chart"&&await this._createLineChart(c,t,e),c.root.dom.classList.toggle(z.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:t}=this;t&&(clearTimeout(t),this._refreshTimer=null)}_updateMediaInfoTimestamp(t){const e=Date.now();this._refreshIntervalInfo={timestamp:e,sourceURL:t&&this._getImageSource(t,e)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:t}=this.viewModel;(t==null?void 0:t.type)==="image"&&(t==null?void 0:t.refreshInterval)>0&&this._setRefreshTimeout(t)}_setRefreshTimeout(t){const{refreshInterval:e,value:i}=t,s=6e4*e;this._updateMediaInfoTimestamp(i.sourceURL);const r=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},s);this._refreshTimer=r}_getImageSource(t,e){const i=t.includes("?")?"&":"?",[s,r=""]=t.split("#");return`${s}${i}timestamp=${e}${r?"#":""}${r}`}};a([l()],X.prototype,"_refreshIntervalInfo",void 0),a([l()],X.prototype,"attributes",null),a([l()],X.prototype,"activeMediaInfoIndex",null),a([l()],X.prototype,"description",null),a([l()],X.prototype,"fieldInfoMap",null),a([l()],X.prototype,"layer",null),a([l()],X.prototype,"mediaInfos",null),a([l()],X.prototype,"popupTemplate",null),a([l()],X.prototype,"relatedInfos",null),a([l()],X.prototype,"title",null),a([l({type:ye})],X.prototype,"viewModel",void 0),a([l(),ee("esri/widgets/Feature/t9n/Feature")],X.prototype,"messages",void 0),X=a([V("esri.widgets.Feature.FeatureMedia")],X);const gi=X,zs="esri.widgets.Feature.support.arcadeFeatureUtils",dt=()=>Xe.getLogger(zs);function Ws(t){return typeof t=="string"?ft(gt(t)):Array.isArray(t)?Qs(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?Xs(t):t}function Qs(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?ft(gt(e)):e}</li>`).join("")}</ul>`}function Xs(t){const e=t.keys().map(i=>{const s=t.field(i);return`<tr><th>${i}</th><td>${typeof s=="string"?ft(gt(s)):s}</td></tr>`}).join("");return`<table class="${$.table}">${e}</table>`}async function _i(){const[t,e]=await Promise.all([F(()=>import("./arcade-CkApeXxD.js"),__vite__mapDeps([55,26,0,1,27,56,57])),F(()=>import("./arcade-BgfxPaiF.js").then(i=>i.aw),__vite__mapDeps([58,0,1,59,26,27,56,60,57,61,62,38,37,39,63]))]);return{executor:t,syntaxUtils:e}}function Ks(t){return"createQuery"in t&&"queryFeatures"in t}async function Ys({graphic:t,view:e,options:i}){const{isAggregate:s,layer:r}=t;if(!s||!r||(e==null?void 0:e.type)!=="2d")return[];const n=await e.whenLayerView(r);if(!Ks(n))return[];const o=n.createQuery(),d=t.getObjectId();o.aggregateIds=d!=null?[d]:[];const{features:c}=await n.queryFeatures(o,i);return c}function Zs({layer:t,aggregatedFeatures:e,interceptor:i}){const{fields:s,objectIdField:r,geometryType:n,spatialReference:o,displayField:d}=t;return new Vi({fields:s,objectIdField:r,geometryType:n,spatialReference:o,displayField:d,interceptor:i,...t.type==="feature"?{templates:t.templates,typeIdField:t.typeIdField,types:t.types}:null,source:e})}function Gs(t){const e=t.declaredClass==="esri.views.3d.layers.VoxelGraphic";return t.isAggregate?"popup-feature-reduction":e?"popup-voxel":"popup"}function vi(t){var e,i;return{scale:t==null?void 0:t.scale,timeProperties:{currentStart:(e=t==null?void 0:t.timeExtent)==null?void 0:e.start,currentEnd:(i=t==null?void 0:t.timeExtent)==null?void 0:i.end,startIncluded:!0,endIncluded:!0}}}function Js(t){return{$voxel:t}}async function er(t,e,i,s,r){let n=null;if(r.has("$aggregatedfeatures")){const o=await Ys({graphic:t,view:e,options:i}),d=t.sourceLayer||t.layer;n=Zs({layer:d,aggregatedFeatures:o,interceptor:s})}return{vars:{$feature:t,$aggregatedFeatures:n,$view:vi(e)},[Symbol.dispose]:()=>n==null?void 0:n[Symbol.dispose]()}}function tr(t,e,i,s){var n;const r=(t.sourceLayer||t.layer)??void 0;return{$feature:t,$layer:r!=null&&rs(r)?r:(r==null?void 0:r.type)==="scene"&&r.associatedLayer!=null?r.associatedLayer:void 0,$map:e,$datastore:r==null?void 0:r.url,$userInput:i,$graph:(r==null?void 0:r.type)==="knowledge-graph-sublayer"?(n=r==null?void 0:r.parentCompositeLayer)==null?void 0:n.knowledgeGraph:void 0,$view:vi(s)}}async function ir(t,{graphic:e,map:i,location:s,view:r,options:n,interceptor:o,arcadeExecutor:d}){switch(t){case"popup":return{vars:tr(e,i,s,r),[Symbol.dispose](){}};case"popup-feature-reduction":{const c=new Set(d.variablesUsed);return await er(e,r,n,o,c)}case"popup-voxel":return{vars:Js(e),[Symbol.dispose](){}};default:throw new Error(`Unexpected profile name ${t}`)}}async function bi({expressionInfo:t,arcade:{executor:e,syntaxUtils:i},graphic:s}){const r=t==null?void 0:t.expression;if(!r)return null;const n=Gs(s),o=e.createArcadeProfile(n);let d;try{d=await e.createArcadeExecutor(r,o)}catch(u){return dt().error("arcade-executor-error",{error:u,expressionInfo:t}),null}const c=new Set;return d.variablesUsed.includes("$view")&&(i.scriptUsesViewProperties(d.syntaxTree,["scale"])&&c.add("view-scale"),i.scriptUsesViewProperties(d.syntaxTree,["timeProperties"])&&c.add("view-time-extent")),{dependencies:c,async evaluate({graphic:u,interceptor:p,location:m,map:y,options:f,spatialReference:g,view:_}){const v=await ir(n,{graphic:u,map:y,location:m,view:_,options:f,interceptor:p,arcadeExecutor:d}),b={abortSignal:(f==null?void 0:f.signal)??void 0,interceptor:p??void 0,rawOutput:!0,spatialReference:g??void 0,timeZone:_==null?void 0:_.timeZone,console(...w){dt().info(...w)}};try{return await d.executeAsync(v.vars,b)}catch(w){return void dt().error("arcade-execution-error",{error:w,graphic:u,expressionInfo:t})}finally{v[Symbol.dispose]()}}}}async function sr(t,e){if(!(t!=null&&t.length))return{dependencies:new Set,expressions:new Map};const i=await _i(),s=new Set,r=new Map;for(const n of t){const o=await bi({expressionInfo:n,arcade:i,graphic:e});r.set(`expression/${n.name}`,o),o==null||o.dependencies.forEach(d=>s.add(d))}return{dependencies:s,expressions:r}}const zt=1;let K=class extends oe{constructor(e){super(e),this._compileTask=null,this._evaluateTask=null,this.expressionInfo=null,this.graphic=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._createVM=()=>{var r,n;const i=(r=this.contentElement)==null?void 0:r.type;(n=this.contentElementViewModel)==null||n.destroy();const s=i==="fields"?new Je:i==="media"?new ye:i==="text"?new Ge:null;this._set("contentElementViewModel",s)},this._compileThrottled=Ze(this._startCompile,()=>this.notifyChange("state"),zt,this),this._evaluateThrottled=Ze(this._startEvaluate,()=>this.notifyChange("state"),zt,this),this.addHandles([L(()=>[this.expressionInfo,this.graphic],()=>this._compileThrottled(),N),L(()=>[this.contentElement],()=>this._createVM(),N),ni(()=>{var r,n,o,d,c,u;if(!((r=this._compileTask)!=null&&r.finished))return null;const i=this._compileTask.value,s=i==null?void 0:i.dependencies;return[i,this.spatialReference,this.map,this.view,s!=null&&s.has("view-scale")?(n=this.view)==null?void 0:n.scale:null,s!=null&&s.has("view-time-extent")?(d=(o=this.view)==null?void 0:o.timeExtent)==null?void 0:d.start:null,s!=null&&s.has("view-time-extent")?(u=(c=this.view)==null?void 0:c.timeExtent)==null?void 0:u.end:null]},([i])=>this._evaluateThrottled(i))])}initialize(){this.addHandles([this._compileThrottled,this._evaluateThrottled])}destroy(){var e;this._compileTask=se(this._compileTask),this._evaluateTask=se(this._evaluateTask),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null)}get contentElement(){var e;return(e=this._evaluateTask)==null?void 0:e.value}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){var s,r;const{contentElement:e,contentElementViewModel:i}=this;return this._compileThrottled.hasPendingUpdates()||this._evaluateThrottled.hasPendingUpdates()||!((s=this._compileTask)!=null&&s.finished)||!((r=this._evaluateTask)!=null&&r.finished)?"loading":e||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}_startCompile(){this._evaluateTask=se(this._evaluateTask),this._compileTask=se(this._compileTask),this._compileTask=Ke(async e=>{const{expressionInfo:i,graphic:s}=this;if(!i||!s)return null;const r=await _i();$e(e);const n=await bi({expressionInfo:i,arcade:r,graphic:s});return $e(e),n})}_startEvaluate(e){this._evaluateTask=se(this._evaluateTask),this._evaluateTask=Ke(async i=>{const{graphic:s}=this;if(!e||!s)return null;const{interceptor:r,spatialReference:n,map:o,location:d,view:c}=this,u=await e.evaluate({graphic:s,interceptor:r,location:d,map:o,options:{signal:i},spatialReference:n,view:c});$e(i);const p=u;if(!p||p.declaredClass!=="esri.arcade.Dictionary")return null;const m=await p.castAsJsonAsync(i);$e(i);const y=m==null?void 0:m.type,f=y==="media"?qi.fromJSON(m):y==="text"?ai.fromJSON(m):y==="fields"?Ni.fromJSON(m):null;return f.type==="media"&&!f.mediaInfos||f.type==="fields"&&!f.fieldInfos||f.type==="text"&&!f.text?null:f})}};a([l()],K.prototype,"_compileTask",void 0),a([l()],K.prototype,"_evaluateTask",void 0),a([l({type:Di})],K.prototype,"expressionInfo",void 0),a([l({type:Ae})],K.prototype,"graphic",void 0),a([l({readOnly:!0})],K.prototype,"contentElement",null),a([l({readOnly:!0})],K.prototype,"contentElementViewModel",void 0),a([l()],K.prototype,"interceptor",void 0),a([l({type:oi})],K.prototype,"location",void 0),a([l()],K.prototype,"spatialReference",null),a([l({readOnly:!0})],K.prototype,"state",null),a([l()],K.prototype,"map",null),a([l()],K.prototype,"view",void 0),K=a([V("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],K);const It=K,Wt="esri-feature",Qt={base:`${Wt}-expression`,loadingSpinnerContainer:`${Wt}__loading-container`};let Ue=class extends re{constructor(t,e){super(t,e),this._contentWidget=null,this.viewModel=new It}initialize(){this.addHandles(L(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentElementViewModel},()=>this._setupExpressionWidget(),N))}loadDependencies(){return Ie({loader:()=>F(()=>import("./index-BYYG-xAB.js").then(t=>t.au),__vite__mapDeps([0,1]))})}destroy(){this._destroyContentWidget()}render(){var e;const{state:t}=this.viewModel;return h("div",{class:Qt.base},t==="loading"?this._renderLoading():t==="disabled"?null:(e=this._contentWidget)==null?void 0:e.render())}_renderLoading(){return h("div",{class:Qt.loadingSpinnerContainer,key:"loading-container"},h("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:t}=this;t&&(t.viewModel=null,t.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:t,contentElement:e}=this.viewModel,i=e==null?void 0:e.type;this._destroyContentWidget();const s=t?i==="fields"?new fi({viewModel:t}):i==="media"?new gi({viewModel:t}):i==="text"?new je({viewModel:t}):null:null;this._contentWidget=s,this.scheduleRender()}};a([l({type:It})],Ue.prototype,"viewModel",void 0),Ue=a([V("esri.widgets.Feature.FeatureExpression")],Ue);const rr=Ue;var He;const ze="esri-feature",Fe=`${ze}-relationship`,ne={base:Fe,listContainer:`${Fe}__list`,listItem:`${Fe}__list-item`,listItemHidden:`${Fe}__list-item--hidden`,listContainerQuerying:`${Fe}__list--querying`,featureObserver:`${ze}__feature-observer`,stickySpinnerContainer:`${ze}__sticky-loading-container`,loadingSpinnerContainer:`${ze}__loading-container`},Xt={title:!0,description:!0};let D=He=class extends re{constructor(t,e){super(t,e),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.flowItems=null,this.flowType="feature-relationship",this.headingLevel=2,this.viewModel=new wt,this.messages=null,this.messagesCommon=null,this.visibleElements={...Xt},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:s,relatedFeatures:r,featuresPerPage:n,featurePage:o}=this.viewModel;i==="ready"&&s&&r.length>=n*o&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Re,this.addHandles([L(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),N),L(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),We(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Ie({chip:()=>F(()=>import("./index-C_HaIepg.js"),__vite__mapDeps([64,0,1,6])),icon:()=>F(()=>import("./index-BYYG-xAB.js").then(t=>t.av),__vite__mapDeps([0,1])),list:()=>F(()=>import("./index-BUoYXUT-.js"),__vite__mapDeps([2,0,1,3,4,5,6,7,8,9,10,11,12,13])),"list-item":()=>F(()=>import("./index-vWjR11Qv.js"),__vite__mapDeps([14,0,1,15,16,12,6,17,18,19,20,21,22,13,23])),loader:()=>F(()=>import("./index-BYYG-xAB.js").then(t=>t.au),__vite__mapDeps([0,1])),notice:()=>F(()=>import("./index-CNBosper.js"),__vite__mapDeps([24,0,1,17]))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=ii(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:t,featureCount:e,displayCount:i,state:s,allCategoriesCount:r}=this.viewModel;return!t&&s==="ready"&&(!!r&&(r>i||i===0)||!!e&&(e>i||i===0))}get displayListItems(){const{relatedFeatureViewModels:t,allCategoriesCount:e}=this.viewModel;return this.displayShowAllButton||!!t.length||!!e}get allItemsDescription(){const{messages:t}=this,{featureCount:e,allCategories:i,allCategoriesCount:s}=this.viewModel;return _t(t==null?void 0:t.numberRecords,{number:ut(i?s:e)})}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get title(){const{activeCategory:t,title:e}=this.viewModel;return(t==null?void 0:t.name)??e}set title(t){this.viewModel.title=t}castVisibleElements(t){return{...Xt,...t}}render(){var e;const{state:t}=this.viewModel;return h("div",{class:this.classes(ne.base,$.widget)},(e=this._featureElementInfo)==null?void 0:e.render(),t==="loading"?this._renderLoading():t==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}async _selectCategory(t){const{flowItems:e,featureVisibleElements:i,viewModel:s}=this;e&&(s.activeCategory=t,s.showAllEnabled=!0,e.push(new He({flowItems:e,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:s})))}async _selectRecord(t){const{flowItems:e,featureVisibleElements:i}=this;if(!e)return;t.abilities={relationshipContent:!0};const{default:s}=await F(()=>Promise.resolve().then(()=>cr),void 0);e.push(new s({flowItems:e,flowType:this.flowType,viewModel:t,visibleElements:i}))}_showAllRecords(){const{flowItems:t}=this;if(!t)return;const{viewModel:e,featureVisibleElements:i}=this;e.showAllEnabled=!0;const s=new He({flowItems:t,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:e});t.push(s)}_renderStickyLoading(){return this.viewModel.state==="querying"?h("div",{class:ne.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return h("calcite-loader",{inline:!0,label:""})}_renderLoading(){return h("div",{class:ne.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return h("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const t=he(this.container)?"chevron-left":"chevron-right";return h("calcite-icon",{icon:t,scale:"s",slot:"content-end"})}_renderCategory(t){const{count:e,name:i,value:s}=t,r=ut(e);return h("calcite-list-item",{class:ne.listItem,disabled:!e,key:s,label:i,onCalciteListItemSelect:()=>this._selectCategory(t)},h("calcite-chip",{label:r,scale:"s",slot:"content-end"},r),this._renderChevronIconNode())}_renderRelatedFeature(t){var r;const{itemDescriptionFieldName:e}=this.viewModel,i=t.title;t.description=e&&((r=t.formattedAttributes)==null?void 0:r.global[e]);const s=t.state==="loading";return h("calcite-list-item",{class:this.classes(ne.listItem,{[ne.listItemHidden]:s}),description:Qe(t.description??""),key:t.uid,label:Qe(i),onCalciteListItemSelect:()=>this._selectRecord(t)},this._renderChevronIconNode())}_renderShowAllListItem(){var t;return this.displayShowAllButton?h("calcite-list-item",{description:this.allItemsDescription,key:"show-all-item",label:(t=this.messages)==null?void 0:t.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){var t;return h("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},h("div",{slot:"message"},(t=this.messages)==null?void 0:t.noRelatedFeatures))}_renderFeatureObserver(){return h("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:ne.featureObserver,key:"feature-observer"})}_renderList(){var i;const{relatedFeatureViewModels:t,categories:e}=this.viewModel;return h("calcite-list",{displayMode:"flat",label:(i=this.messages)==null?void 0:i.relatedFeaturesList},(e==null?void 0:e.map(s=>this._renderCategory(s)))??t.toArray().map(s=>this._renderRelatedFeature(s)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:t}=this,{state:e}=this.viewModel;return h("div",{class:this.classes(ne.listContainer,{[ne.listContainerQuerying]:e==="querying"}),key:"list-container"},t?this._renderList():e==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){var t;return h("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},h("div",{slot:"message"},(t=this.messages)==null?void 0:t.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:t}=this.viewModel,e="related-feature-viewmodels";this.removeHandles(e),t==null||t.forEach(i=>{this.addHandles(L(()=>[i.title,i.state],()=>this.scheduleRender(),N),e)}),this.scheduleRender()}_setupFeatureElementInfo(){var r;const{headingLevel:t,visibleElements:e}=this,i=e.description&&this.description,s=e.title&&this.title;(r=this._featureElementInfo)==null||r.set({description:i,title:s,headingLevel:t})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:t,showAllEnabled:e}=this.viewModel;await ji(0),this._relatedFeatureIntersectionObserverNode&&t==="ready"&&e&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(t){this._relatedFeatureIntersectionObserverNode=t}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};a([l()],D.prototype,"_relatedFeatureIntersectionObserverNode",void 0),a([l({readOnly:!0})],D.prototype,"displayShowAllButton",null),a([l({readOnly:!0})],D.prototype,"displayListItems",null),a([l({readOnly:!0})],D.prototype,"allItemsDescription",null),a([l()],D.prototype,"description",null),a([l()],D.prototype,"featureVisibleElements",void 0),a([l()],D.prototype,"flowItems",void 0),a([l()],D.prototype,"flowType",void 0),a([l()],D.prototype,"headingLevel",void 0),a([l()],D.prototype,"title",null),a([l({type:wt})],D.prototype,"viewModel",void 0),a([l(),ee("esri/widgets/Feature/t9n/Feature")],D.prototype,"messages",void 0),a([l(),ee("esri/t9n/common")],D.prototype,"messagesCommon",void 0),a([l()],D.prototype,"visibleElements",void 0),a([we("visibleElements")],D.prototype,"castVisibleElements",null),D=He=a([V("esri.widgets.Feature.FeatureRelationship")],D);const nr=D;let ar=class{constructor(e,i){this.preLayerQueryCallback=e,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=s=>{}),this.preRequestCallback||(this.preLayerQueryCallback=s=>{})}};var ve;const Kt=1,Yt="content-view-models",Zt="relationship-view-models",or="association-view-models",Gt={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0};let E=ve=class extends mt.IdentifiableMixin(oe){constructor(t){super(t),this._error=null,this._graphicChangedTask=null,this._evaluateExpressionAttributesTask=null,this._associationVMAbortController=null,this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Gt},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._graphicChangedThrottled=Ze(this._graphicChanged,()=>this.notifyChange("waitingForContent"),Kt,this),this._isAllowedContentType=e=>{const{abilities:i}=this;return e.type==="attachments"&&!!i.attachmentsContent||e.type==="custom"&&!!i.customContent||e.type==="fields"&&!!i.fieldsContent||e.type==="media"&&!!i.mediaContent||e.type==="text"&&!!i.textContent||e.type==="expression"&&!!i.expressionContent||e.type==="relationship"&&!!i.relationshipContent||e.type==="utility-network-associations"&&!!i.utilityNetworkAssociationsContent},this._evaluateExpressionAttributesThrottled=Ze(this._evaluateExpressionAttributes,()=>this.notifyChange("waitingForContent"),Kt,this),this.addHandles([L(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),N),ni(()=>{var s,r,n,o,d,c,u;if(!((s=this._graphicChangedTask)!=null&&s.finished)||this._graphicChangedTask.value==null)return null;const e=this._graphicChangedTask.value,i=(r=e==null?void 0:e.expressionInfos)==null?void 0:r.dependencies;return[e,i!=null&&i.has("view-scale")?(n=this.view)==null?void 0:n.scale:null,i!=null&&i.has("view-time-extent")?(d=(o=this.view)==null?void 0:o.timeExtent)==null?void 0:d.start:null,i!=null&&i.has("view-time-extent")?(u=(c=this.view)==null?void 0:c.timeExtent)==null?void 0:u.end:null]},([e])=>this._evaluateExpressionAttributesThrottled(e))])}initialize(){this.addHandles([this._graphicChangedThrottled,this._evaluateExpressionAttributesThrottled])}destroy(){this._clear(),this._graphicChangedTask=se(this._graphicChangedTask),this._evaluateExpressionAttributesTask=se(this._evaluateExpressionAttributesTask),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return Yi(St(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return li(this.graphic)}castAbilities(t){return{...Gt,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",(t==null?void 0:t.clone())??null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get timeZone(){var t;return((t=this.view)==null?void 0:t.timeZone)??Bi}set timeZone(t){this._overrideIfSome("timeZone",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){const{_graphicChangedThrottled:t,_evaluateExpressionAttributesThrottled:e,_graphicChangedTask:i,_evaluateExpressionAttributesTask:s,_associationVMAbortController:r}=this;return t.hasPendingUpdates()||e.hasPendingUpdates()||i!=null&&!i.finished||s!=null&&!s.finished||!!r}setActiveMedia(t,e){const i=this.contentViewModels[t];i instanceof ye&&i.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof ye&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof ye&&e.previous()}async updateGeometry(){var o;const{graphic:t,spatialReference:e,_sourceLayer:i}=this;await(i==null?void 0:i.load());const s=i==null?void 0:i.objectIdField;if(!s||!t||!i)return;const r=(o=t==null?void 0:t.attributes)==null?void 0:o[s];if(r==null)return;const n=[r];if(!t.geometry){const d=await Zi({layer:i,graphic:t,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:e}),c=d==null?void 0:d.geometry;c&&(t.geometry=c)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){this._evaluateExpressionAttributesTask=se(this._evaluateExpressionAttributesTask),this._graphicChangedTask=se(this._graphicChangedTask),this._graphicChangedTask=Ke(async t=>{this._error=null,this._clear();const{graphic:e}=this;try{if(!e)return null;const{_sourceLayer:i,_effectivePopupTemplate:s}=this,r=this.spatialReference;await Gi({graphic:e,popupTemplate:s,layer:i,spatialReference:r},{signal:t});const[{value:n},{value:o}]=await be([this._getContent(),this._getTitle()]),[,{value:d}]=await be([this._checkForRelatedFeatures({signal:t}),sr(s==null?void 0:s.expressionInfos,e)]);return{expressionInfos:d,content:n,title:o}}catch(i){throw xt(i)||(this._error=i,Xe.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate})),i}})}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):t.type==="utility-network-associations"?this._compileUtilityNetworkAssociation(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,i)=>this._compileContentElement(e,i)).filter(Le):typeof t=="string"?this._compileText(new ai({text:t}),0).text:t}_destroyContentViewModels(){this.removeHandles(Zt),this.removeHandles(Yt),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var r;const i=(r=t==null?void 0:t.graphic)==null?void 0:r.getObjectId(),s=e==null?void 0:e.getObjectId();return i!=null&&s!=null&&i===s}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:i}){const{view:s,spatialReference:r,timeZone:n}=this;e==null||e.filter(Boolean).forEach(o=>{t.some(d=>this._matchesFeature(d,o))||t.add(new ve({abilities:{relationshipContent:!1},map:i,view:s,spatialReference:r,timeZone:n,graphic:o}))}),t.forEach(o=>{(e==null?void 0:e.find(c=>this._matchesFeature(o,c)))||t.remove(o)})}_setExpressionContentVM(t,e){const i=this.formattedAttributes,{contentElement:s,contentElementViewModel:r}=t,n=s==null?void 0:s.type;r&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:s,contentElementIndex:e,formattedAttributes:i}),r.set(this._createFieldsVMParams(s,e))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:s,contentElementIndex:e,formattedAttributes:i}),r.set(this._createMediaVMParams(s,e))),n==="text"&&r.set(this._createTextVMParams(s)))}_compileRelationship(t,e){const{displayCount:i,orderByFields:s,relationshipId:r,title:n,description:o}=t,{_sourceLayer:d,graphic:c,map:u}=this;if(!di(d))return;const p=new wt({displayCount:i,graphic:c,orderByFields:s,relationshipId:r,layer:d,map:u,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[e]=p,this.addHandles(We(()=>p.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(p)),Zt),t}_matchesGlobalFeature(t,e){const i=t==null?void 0:t.association.globalId,s=e==null?void 0:e.association.globalId;return i!=null&&s!=null&&i===s}async _setUpUtilityNetworkAssociationsViewModels(t,e,i){const{view:s,spatialReference:r,timeZone:n}=this;t.forEach((d,c)=>{const u=e.get(c);u?d.forEach(p=>{u.find(m=>this._matchesGlobalFeature(p,m))||(d.remove(p),d.length===0&&t.delete(c))}):(d.removeAll(),t.delete(c))}),e.forEach((d,c)=>{const u=t.get(c)||new J;d==null||d.filter(Boolean).forEach(p=>{u.some(m=>this._matchesGlobalFeature(m,p))||u.add({association:p.association,featureViewModel:new ve({abilities:{utilityNetworkAssociationsContent:!1},map:i,view:s,spatialReference:r,timeZone:n,graphic:p.feature}),terminalName:p.terminalName})}),t.set(c,u)});const o=new AbortController;this._associationVMAbortController=o,await this._sortListObjectsByTitle(t,{signal:o.signal}),this._associationVMAbortController===o&&(this._associationVMAbortController=null)}async _sortListObjectsByTitle(t,e){for(const i of t.values()){const s=i.map(r=>Ui(()=>r.featureViewModel.state==="ready",e==null?void 0:e.signal));await Promise.all(s),i.sort(this._compareByFeatureTitle)}}_compareByFeatureTitle(t,e){const i=kt(t.featureViewModel),s=kt(e.featureViewModel);return i.localeCompare(s,void 0,{numeric:!0})}_compileUtilityNetworkAssociation(t,e){const{displayCount:i,title:s,description:r,associationTypes:n}=t,{_sourceLayer:o,graphic:d,map:c}=this;if(!Ji(o))return;const u=new bt({graphic:d,displayCount:i,associationTypes:n,layer:o,map:c,...this._compileTitleAndDesc({title:s,description:r})});return this.contentViewModels[e]=u,this.addHandles([L(()=>u.associationFeatures.values(),()=>this._setUpUtilityNetworkAssociationsViewModels(u.associationViewModels,u.associationFeatures,u.map))],or),t}_compileExpression(t,e){const{expressionInfo:i}=t,{graphic:s,map:r,spatialReference:n,view:o,location:d}=this,c=new It({expressionInfo:i,graphic:s,interceptor:ve.interceptor,map:r,spatialReference:n,view:o,location:d});return this.contentViewModels[e]=c,this.addHandles(L(()=>c.contentElementViewModel,()=>this._setExpressionContentVM(c,e),N),Yt),t}_compileAttachments(t,e){const{graphic:i}=this,{description:s,title:r,orderByFields:n}=t;return this.contentViewModels[e]=new At({graphic:i,orderByFields:n,...this._compileTitleAndDesc({title:r,description:s})}),t}_compileCustom(t,e){const{graphic:i}=this,{creator:s,destroyer:r}=t;return this.contentViewModels[e]=new Ge({graphic:i,creator:s,destroyer:r}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:i,_sourceLayer:s,graphic:r,formattedAttributes:n}=this,o=r==null?void 0:r.attributes,d=this._expressionAttributes,c=n.global;return{title:me({attributes:o,fieldInfoMap:i,globalAttributes:c,expressionAttributes:d,layer:s,text:t}),description:me({attributes:o,fieldInfoMap:i,globalAttributes:c,expressionAttributes:d,layer:s,text:e})}}_createFieldsVMParams(t,e){const i=this._effectivePopupTemplate,s=this.formattedAttributes,r={...s==null?void 0:s.global,...s==null?void 0:s.content[e]},n=(t==null?void 0:t.fieldInfos)||(i==null?void 0:i.fieldInfos),o=n==null?void 0:n.filter(({fieldName:p})=>!!p&&(hi(p)||pe(p)||r.hasOwnProperty(p))),d=i==null?void 0:i.expressionInfos,{description:c,title:u}=t;return{attributes:r,expressionInfos:d,fieldInfos:o,...this._compileTitleAndDesc({title:u,description:c})}}_compileFields(t,e){const i=t.clone(),s=new Je(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=s,i.fieldInfos=s.formattedFieldInfos.slice(),i}_createMediaVMParams(t,e){const{abilities:i,graphic:s,_fieldInfoMap:r,_effectivePopupTemplate:n,relatedInfos:o,_sourceLayer:d,_expressionAttributes:c}=this,u=this.formattedAttributes,p=(s==null?void 0:s.attributes)??{},{description:m,mediaInfos:y,title:f}=t;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:p,isAggregate:s==null?void 0:s.isAggregate,layer:d,fieldInfoMap:r,formattedAttributes:{...u==null?void 0:u.global,...u==null?void 0:u.content[e]},expressionAttributes:c,mediaInfos:y,popupTemplate:n,relatedInfos:o,...this._compileTitleAndDesc({title:f,description:m})}}_compileMedia(t,e){const i=t.clone(),s=new ye(this._createMediaVMParams(t,e));return i.mediaInfos=s.formattedMediaInfos.slice(),this.contentViewModels[e]=s,i}_createTextVMParams(t){var n;const{graphic:e,_fieldInfoMap:i,_sourceLayer:s,_expressionAttributes:r}=this;if(t&&t.text){const o=(e==null?void 0:e.attributes)??{},d=((n=this.formattedAttributes)==null?void 0:n.global)??{};t.text=me({attributes:o,fieldInfoMap:i,globalAttributes:d,expressionAttributes:r,layer:s,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const i=t.clone();return this.contentViewModels[e]=new Ge(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:i,timeZone:s}=this;if(!t)return;const{lastEditInfoEnabled:r}=t,n=e==null?void 0:e.editFieldsInfo;return r&&n?es(n,i==null?void 0:i.attributes,s,e):void 0}_compileTitle(t){var d;const{_fieldInfoMap:e,_sourceLayer:i,graphic:s,_expressionAttributes:r}=this,n=(s==null?void 0:s.attributes)??{},o=((d=this.formattedAttributes)==null?void 0:d.global)??{};return me({attributes:n,fieldInfoMap:e,globalAttributes:o,expressionAttributes:r,layer:i,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;return e?Ye({type:"title",value:t==null?void 0:t.title,event:{graphic:e}}):null}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;return e?Ye({type:"content",value:t==null?void 0:t.content,event:{graphic:e}}):null}_evaluateExpressionAttributes({title:t,content:e,expressionInfos:i}){this._evaluateExpressionAttributesTask=se(this._evaluateExpressionAttributesTask),this._evaluateExpressionAttributesTask=Ke(async s=>{const{graphic:r,map:n,view:o,spatialReference:d,location:c}=this;try{if(!r)return;let u;if(i!=null){const p=[];for(const[m,y]of i.expressions.entries())y!=null?p.push(y.evaluate({graphic:r,interceptor:ve.interceptor,location:c,map:n,options:{signal:s},spatialReference:d,view:o}).then(f=>[m,Ws(f)]).catch(()=>[m,void 0])):p.push(Promise.resolve([m,void 0]));u=Object.fromEntries(await Promise.all(p)),$e(s)}this._expressionAttributes=u,this._graphicExpressionAttributes={...r.attributes,...u},this._set("formattedAttributes",this._createFormattedAttributes(e)),this._set("title",this._compileTitle(t)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(e)||null)}catch(u){xt(u)||(this._error=u,Xe.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:u,graphic:r,popupTemplate:this._effectivePopupTemplate}))}})}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){const{_effectivePopupTemplate:s,graphic:r,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:d,_graphicExpressionAttributes:c,timeZone:u}=this;i.content[e]=et({fieldInfos:s==null?void 0:s.fieldInfos,graphic:r,attributes:{...c,...t.attributes},layer:o,fieldInfoMap:d,relatedInfos:n,timeZone:u})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){if(t.fieldInfos){const{graphic:s,relatedInfos:r,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:d,timeZone:c}=this;i.content[e]=et({fieldInfos:t.fieldInfos,graphic:s,attributes:{...d,...t.attributes},layer:n,fieldInfoMap:o,relatedInfos:r,timeZone:c})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:i,relatedInfos:s,_sourceLayer:r,_fieldInfoMap:n,_graphicExpressionAttributes:o,timeZone:d}=this,c=e==null?void 0:e.fieldInfos,u={global:et({fieldInfos:c,graphic:i,attributes:o,layer:r,fieldInfoMap:n,relatedInfos:s,timeZone:d}),content:[]};return Array.isArray(t)&&t.forEach((p,m)=>{p.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:p,contentElementIndex:m,formattedAttributes:u}),p.type==="media"&&this._createMediaFormattedAttributes({contentElement:p,contentElementIndex:m,formattedAttributes:u})}),u}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(e,St(i),t)}async _queryRelatedInfos(t,e,i){const{relatedInfos:s,_sourceLayer:r}=this;s.clear();const n=(r==null?void 0:r.associatedLayer)!=null?await(r==null?void 0:r.associatedLayer.load(i)):r;if(!n||!t)return;const o=e.filter(u=>!!u.fieldName&&pe(u.fieldName));if(!(o!=null&&o.length))return;e.forEach(u=>this._configureRelatedInfo(u,n));const d=await Vs({relatedInfos:s,layer:n},i);Object.keys(d).forEach(u=>{var y;const p=s.get(u.toString()),m=(y=d[u])==null?void 0:y.value;p&&m&&(p.layerInfo=m.data)});const c=await qs({graphic:t,relatedInfos:s,layer:n},i);Object.keys(c).forEach(u=>{var p;xs((p=c[u])==null?void 0:p.value,s.get(u.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:i}=this,s=Be(t.fieldName||"");if(!s)return;const{layerId:r,fieldName:n}=s;if(!r)return;const o=i.get(r.toString())||Es(r,e);o&&(Ns({relatedInfo:o,fieldName:n,fieldInfo:t}),this.relatedInfos.set(r,o))}};E.interceptor=new ar(ts,is),a([l()],E.prototype,"_error",void 0),a([l()],E.prototype,"_graphicChangedTask",void 0),a([l()],E.prototype,"_evaluateExpressionAttributesTask",void 0),a([l()],E.prototype,"_associationVMAbortController",void 0),a([l({readOnly:!0})],E.prototype,"_effectivePopupTemplate",null),a([l({readOnly:!0})],E.prototype,"_fieldInfoMap",null),a([l({readOnly:!0})],E.prototype,"_sourceLayer",null),a([l()],E.prototype,"abilities",void 0),a([we("abilities")],E.prototype,"castAbilities",null),a([l({readOnly:!0})],E.prototype,"content",void 0),a([l({readOnly:!0})],E.prototype,"contentViewModels",void 0),a([l()],E.prototype,"description",void 0),a([l({type:Boolean})],E.prototype,"defaultPopupTemplateEnabled",void 0),a([l({readOnly:!0})],E.prototype,"isTable",null),a([l({readOnly:!0})],E.prototype,"state",null),a([l({readOnly:!0})],E.prototype,"formattedAttributes",void 0),a([l({type:Ae,value:null})],E.prototype,"graphic",null),a([l({readOnly:!0})],E.prototype,"lastEditInfo",void 0),a([l({type:oi})],E.prototype,"location",void 0),a([l({readOnly:!0})],E.prototype,"relatedInfos",void 0),a([l({type:Hi})],E.prototype,"spatialReference",null),a([l()],E.prototype,"timeZone",null),a([l({readOnly:!0})],E.prototype,"title",void 0),a([l()],E.prototype,"map",null),a([l({readOnly:!0})],E.prototype,"waitingForContent",null),a([l()],E.prototype,"view",void 0),E=ve=a([V("esri.widgets.Feature.FeatureViewModel")],E);const wi=E,te="esri-feature",O={base:te,container:`${te}__size-container`,title:`${te}__title`,main:`${te}__main-container`,contentNode:`${te}__content-node`,contentNodeText:`${te}__content-node--text`,contentElement:`${te}__content-element`,text:`${te}__text`,lastEditedInfo:`${te}__last-edited-info`,loadingSpinnerContainer:`${te}__loading-container`},lr=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=i=>pi(i)&&!i.destroyed?h("div",{class:O.contentNode,key:i},i.render()):i instanceof HTMLElement?h("div",{afterCreate:this._attachToNode,bind:i,class:O.contentNode,key:i}):ss(i)?h("div",{afterCreate:this._attachToNode,bind:i.domNode,class:O.contentNode,key:i}):null}_attachToNode(i){const s=this;i.appendChild(s)}};return e=a([V("esri.widgets.Feature.support.FeatureContentMixin")],e),e},Jt={title:!0,content:!0,lastEditedInfo:!0};let S=class extends lr(re){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowType="feature",this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...Jt},this.viewModel=new wi}initialize(){this.addHandles(L(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),N))}loadDependencies(){return Ie({notice:()=>F(()=>import("./index-CNBosper.js"),__vite__mapDeps([24,0,1,17])),loader:()=>F(()=>import("./index-BYYG-xAB.js").then(t=>t.au),__vite__mapDeps([0,1]))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get location(){return this.viewModel.location}set location(t){this.viewModel.location=t}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get timeZone(){return this.viewModel.timeZone}set timeZone(t){this.viewModel.timeZone=t}get title(){return this.viewModel.title}castVisibleElements(t){return{...Jt,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}render(){const{state:t}=this.viewModel,e=h("div",{class:O.container,key:"container"},this._renderTitle(),t==="error"?this._renderError():t==="loading"?this._renderLoading():this._renderContentContainer());return h("div",{class:this.classes(O.base,$.widget)},e)}_renderError(){const{messagesCommon:t,messages:e,visibleElements:i}=this;return h("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?h("div",{key:"error-title",slot:"title"},t.errorMessage):null,h("div",{key:"error-message",slot:"message"},e.loadingError))}_renderLoading(){return h("div",{class:O.loadingSpinnerContainer,key:"loading-container"},h("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:t}=this;return t.content?h("div",{class:O.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:t,title:e}=this;return t.title?h(ei,{class:O.title,innerHTML:e,level:this.headingLevel}):null}_renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?h("div",{class:O.contentNode,key:`${e}-content-elements`},t.map(this._renderContentElement,this)):null;if(typeof t=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:h("div",{class:this.classes(O.contentNode,O.contentNodeText),key:`${e}-content`},i.render())}return this.renderNodeContent(t)}_renderContentElement(t,e){var s;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((s=i.content)!=null&&s[t.type]))return null;switch(t.type){case"attachments":return this._renderAttachments(e);case"custom":return this._renderCustom(t,e);case"fields":return this._renderFields(e);case"media":return this._renderMedia(e);case"text":return this._renderText(t,e);case"expression":return this._renderExpression(e);case"relationship":return this._renderRelationship(e);case"utility-network-associations":return this._renderAssociation(e);default:return null}}_renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:i,attachmentInfos:s}=e.viewModel;return i==="loading"||s.length>0?h("div",{class:this.classes(O.contentElement),key:this._buildKey("attachments-element",t)},e.render()):null}_renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?h("div",{class:O.contentElement,key:this._buildKey("relationship-element",t)},e.render()):null}_renderAssociation(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?h("div",{class:O.contentElement,key:this._buildKey("utility-network-association-element",t)},e.render()):null}_renderExpression(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&e.viewModel.contentElement?h("div",{class:O.contentElement,key:this._buildKey("expression-element",t)},e.render()):null}_renderCustom(t,e){const{creator:i}=t,s=this._contentWidgets[e];return!s||s.destroyed?null:i?h("div",{class:O.contentElement,key:this._buildKey("custom-element",e)},s.render()):null}_renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:h("div",{class:O.contentElement,key:this._buildKey("fields-element",t)},e.render())}_renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:h("div",{class:O.contentElement,key:this._buildKey("media-element",t)},e.render())}_renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:i}=this.viewModel;if(!i||!t.lastEditedInfo)return null;const{date:s,user:r}=i,n=i.type==="edit"?r?e.lastEditedByUser:e.lastEdited:r?e.lastCreatedByUser:e.lastCreated,o=_t(n,{date:s,user:r});return h("div",{class:this.classes(O.lastEditedInfo,O.contentElement),key:"edit-info-element"},o)}_renderText(t,e){const i=t.text,s=this._contentWidgets[e];return!s||s.destroyed?null:i?h("div",{class:this.classes(O.contentElement,O.text),key:this._buildKey("text-element",e)},s.render()):null}_buildKey(t,...e){var i,s;return`${t}__${((s=(i=this.viewModel)==null?void 0:i.graphic)==null?void 0:s.uid)||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e,flowItems:i,viewModel:s}=this,r=s==null?void 0:s.content,{contentViewModels:n}=s;if(Array.isArray(r))r.forEach((o,d)=>{if(o.type==="attachments"&&(this._contentWidgets[d]=new cs({displayType:o.displayType,headingLevel:e.title&&t<6?t+1:t,viewModel:n[d]})),o.type==="fields"&&(this._contentWidgets[d]=new fi({viewModel:n[d]})),o.type==="media"&&(this._contentWidgets[d]=new gi({viewModel:n[d]})),o.type==="text"&&(this._contentWidgets[d]=new je({viewModel:n[d]})),o.type==="custom"&&(this._contentWidgets[d]=new je({viewModel:n[d]})),o.type==="expression"&&(this._contentWidgets[d]=new rr({viewModel:n[d]})),o.type==="relationship"){const c=new nr({flowItems:i,featureVisibleElements:e,viewModel:n[d]});this._contentWidgets[d]=c}if(o.type==="utility-network-associations"){const c=async p=>{const{viewModel:m,listType:y,title:f}=p;if(!i)return;m.activeAssociationType=y;const{default:g}=await F(()=>import("./FeatureUtilityNetworkAssociationList-DRYUj-Jm.js"),__vite__mapDeps([65,0,1,26,27,66,67,68,30,69,70,71,33,34,35,36,37,38,39,60,57])),_=new g({viewModel:m,parentFeatureViewModel:s,listType:y,title:f,featureVisibleElements:e,description:s.title,flowItems:i});i.push(_)},u=new ls({flowItems:i,onSelectAssociationType:c,parentFeatureViewModel:s,featureVisibleElements:e,viewModel:n[d]});this._contentWidgets[d]=u}},this);else{const o=n[0];o&&!o.destroyed&&(this._contentWidgets[0]=new je({viewModel:o}))}this.scheduleRender()}};a([l()],S.prototype,"flowType",void 0),a([l()],S.prototype,"graphic",null),a([l()],S.prototype,"defaultPopupTemplateEnabled",null),a([l()],S.prototype,"flowItems",void 0),a([l()],S.prototype,"headingLevel",void 0),a([l({readOnly:!0})],S.prototype,"isTable",null),a([l()],S.prototype,"icon",null),a([l()],S.prototype,"label",null),a([l()],S.prototype,"location",null),a([l(),ee("esri/widgets/Feature/t9n/Feature")],S.prototype,"messages",void 0),a([l(),ee("esri/t9n/common")],S.prototype,"messagesCommon",void 0),a([l()],S.prototype,"spatialReference",null),a([l()],S.prototype,"timeZone",null),a([l({readOnly:!0})],S.prototype,"title",null),a([l()],S.prototype,"visibleElements",void 0),a([we("visibleElements")],S.prototype,"castVisibleElements",null),a([l()],S.prototype,"map",null),a([l()],S.prototype,"view",null),a([l({type:wi})],S.prototype,"viewModel",void 0),S=a([V("esri.widgets.Feature")],S);const dr=S,cr=Object.freeze(Object.defineProperty({__proto__:null,default:dr},Symbol.toStringTag,{value:"Module"}));export{cr as F,bt as _,wi as c,Ze as e,yi as i,dr as j,lr as n,O as t};
